"use strict";(()=>{var a={};a.id=2772,a.ids=[2772],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},38929:(a,b,c)=>{let d,e;c.d(b,{Gg:()=>i,Ov:()=>j,authAdmin:()=>e,dbAdmin:()=>d});var f=c(46675);let g=function(){let a=process.env.VERCEL_ENV;return"production"===a?"production":"preview"===a?"staging":"production"}(),h=!1;try{if(f.apps.length)d=f.firestore(),e=f.auth(),h=!0,console.log(`ðŸ”„ Firebase Admin: Using existing app for ${g}`);else{let a;if(process.env.FIREBASE_PRIVATE_KEY_BASE64&&process.env.FIREBASE_CLIENT_EMAIL)try{let b=Buffer.from(process.env.FIREBASE_PRIVATE_KEY_BASE64,"base64").toString("utf-8");a=f.credential.cert({projectId:process.env.FIREBASE_PROJECT_ID||"hive-dev-2025",clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:b}),console.log(`ðŸ” Firebase Admin: Using base64 private key for ${g}`)}catch(a){console.error("Failed to decode base64 private key:",a)}else if(process.env.FIREBASE_PRIVATE_KEY&&process.env.FIREBASE_CLIENT_EMAIL)a=f.credential.cert({projectId:process.env.FIREBASE_PROJECT_ID||"hive-dev-2025",clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")}),console.log(`ðŸ” Firebase Admin: Using individual env vars for ${g}`);else if(process.env.FIREBASE_SERVICE_ACCOUNT_KEY)try{let b=JSON.parse(Buffer.from(process.env.FIREBASE_SERVICE_ACCOUNT_KEY,"base64").toString("ascii"));a=f.credential.cert(b),console.log(`ðŸ” Firebase Admin: Using base64 service account for ${g}`)}catch(a){console.warn("Failed to parse base64 service account:",a)}else try{a=f.credential.applicationDefault(),console.log(`ðŸ”‘ Firebase Admin: Using application default credentials for ${g}`)}catch(a){throw console.warn(`âš ï¸ No Firebase Admin credentials available for ${g}`),a}if(a)f.initializeApp({credential:a,projectId:process.env.FIREBASE_PROJECT_ID||"hive-dev-2025"}),d=f.firestore(),e=f.auth(),h=!0,console.log(`âœ… Firebase Admin initialized successfully for ${g}`);else throw Error("No valid Firebase credentials found")}}catch(a){console.warn(`âš ï¸ Firebase Admin initialization failed for ${g}:`,a),d={collection:a=>({get:async()=>{throw console.log(`ðŸ”„ Mock Firebase call: collection(${a}).get() - returning development data`),Error(`Firebase Admin not configured for ${g}. Add credentials to environment variables.`)},add:async()=>{throw console.log(`ðŸ”„ Mock Firebase call: collection(${a}).add() - development mode`),Error(`Firebase Admin not configured for ${g}.`)},doc:b=>({get:async()=>{throw console.log(`ðŸ”„ Mock Firebase call: collection(${a}).doc(${b}).get() - development mode`),Error(`Firebase Admin not configured for ${g}.`)},set:async()=>{throw console.log(`ðŸ”„ Mock Firebase call: collection(${a}).doc(${b}).set() - development mode`),Error(`Firebase Admin not configured for ${g}.`)},update:async()=>{throw console.log(`ðŸ”„ Mock Firebase call: collection(${a}).doc(${b}).update() - development mode`),Error(`Firebase Admin not configured for ${g}.`)},delete:async()=>{throw console.log(`ðŸ”„ Mock Firebase call: collection(${a}).doc(${b}).delete() - development mode`),Error(`Firebase Admin not configured for ${g}.`)}}),where:()=>({get:async()=>{throw console.log(`ðŸ”„ Mock Firebase call: collection(${a}).where().get() - development mode`),Error(`Firebase Admin not configured for ${g}.`)},limit:()=>({get:async()=>{throw console.log(`ðŸ”„ Mock Firebase call: collection(${a}).where().limit().get() - development mode`),Error(`Firebase Admin not configured for ${g}.`)}})})})},e={verifyIdToken:async()=>{throw console.log(`ðŸ”„ Mock Firebase call: verifyIdToken() - development mode`),Error(`Firebase Auth not configured for ${g}.`)},createCustomToken:async a=>{throw console.log(`ðŸ”„ Mock Firebase call: createCustomToken(${a}) - development mode`),Error(`Firebase Auth not configured for ${g}.`)},getUser:async a=>{throw console.log(`ðŸ”„ Mock Firebase call: getUser(${a}) - development mode`),Error(`Firebase Auth not configured for ${g}.`)}}}let i=h,j={environment:g,firebaseConfigured:h,projectId:process.env.FIREBASE_PROJECT_ID||"hive-dev-2025",credentialSource:h?process.env.FIREBASE_PRIVATE_KEY?"individual_vars":process.env.FIREBASE_SERVICE_ACCOUNT_KEY?"base64_key":"application_default":"none"}},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46675:a=>{a.exports=require("firebase-admin")},54144:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>S,patchFetch:()=>R,routeModule:()=>N,serverHooks:()=>Q,workAsyncStorage:()=>O,workUnitAsyncStorage:()=>P});var d={};c.r(d),c.d(d,{GET:()=>J});var e=c(98128),f=c(48869),g=c(78868),h=c(37526),i=c(21884),j=c(261),k=c(24218),l=c(73640),m=c(66376),n=c(36363),o=c(73605),p=c(76583),q=c(19465),r=c(78910),s=c(86439),t=c(48724),u=c(73641),v=c(35263),w=c(38929),x=c(359),y=c(97338);let z=process.env.UPSTASH_REDIS_REST_URL,A=process.env.UPSTASH_REDIS_REST_TOKEN,B=!!(z&&A);class C{constructor(a){this.eventHandlers=new Map,this.client=a}async get(a){return this.client.get(a)}async set(a,b,...c){if(c.length>=2&&"PX"===c[0]&&"number"==typeof c[1]){let d=c[1];await this.client.set(a,b,{px:d})}else await this.client.set(a,b);return"OK"}async setex(a,b,c){return await this.client.set(a,c,{ex:b}),"OK"}async del(...a){return 0===a.length?0:this.client.del(...a)}async exists(a){return this.client.exists(a)}async keys(a){return this.client.keys(a)}async mget(...a){return 0===a.length?[]:this.client.mget(...a)}async incrby(a,b){return this.client.incrby(a,b)}async ping(){return this.client.ping()}async info(a){return`# Server
redis_version:7.0.0-upstash
used_memory:0
used_memory_human:0K
connected_clients:1
uptime_in_seconds:0`}async flushall(){return await this.client.flushall(),"OK"}async quit(){return"OK"}pipeline(){let a=[];return{setex:(b,c,d)=>(a.push(async()=>(await this.setex(b,c,d),"OK")),this),exec:async()=>(await Promise.all(a.map(a=>a()))).map(a=>[a])}}on(a,b){let c=this.eventHandlers.get(a)||[];c.push(b),this.eventHandlers.set(a,c),"ready"===a&&setTimeout(b,100)}}let D=null;async function E(){return B?D||(D=(async()=>{try{let{Redis:a}=await c.e(3498).then(c.bind(c,43498)),b=new a({url:z,token:A});return y.v.info("Upstash Redis client initialized for caching"),new C(b)}catch(a){return y.v.error("Failed to initialize Upstash Redis client",{component:"redis-client"},a instanceof Error?a:void 0),null}})()):null}class F{async get(a){let b=this.data.get(a);return b?b.expiry&&Date.now()>b.expiry?(this.data.delete(a),null):b.value:null}async set(a,b,...c){let d={value:b};if(c.length>=2&&"PX"===c[0]&&"number"==typeof c[1]){let a=c[1];d.expiry=Date.now()+a}return this.data.set(a,d),"OK"}async setex(a,b,c){return this.data.set(a,{value:c,expiry:Date.now()+1e3*b}),"OK"}async del(...a){let b=0;return a.forEach(a=>{this.data.delete(a)&&b++}),b}async exists(a){let b=this.data.get(a);return b?b.expiry&&Date.now()>b.expiry?(this.data.delete(a),0):1:0}async keys(a){let b=new RegExp(a.replace("*",".*"));return Array.from(this.data.keys()).filter(a=>b.test(a))}async mget(...a){return Promise.all(a.map(a=>this.get(a)))}async incrby(a,b){let c=(parseInt(await this.get(a)||"0")+b).toString();return await this.set(a,c),parseInt(c)}async ping(){return"PONG"}async info(a){return`# ${a||"Server"}
redis_version:7.0.0-mock
used_memory:1024
used_memory_human:1.00K
used_memory_rss:2048
used_memory_peak:2048
maxmemory:0
mem_fragmentation_ratio:1.0
connected_clients:1
uptime_in_seconds:3600`}async flushall(){return this.data.clear(),"OK"}async quit(){return this.data.clear(),"OK"}pipeline(){return{setex:(a,b,c)=>this.setex(a,b,c),exec:async()=>[["OK"]]}}on(a,b){"ready"===a&&setTimeout(b,100)}constructor(){this.data=new Map}}class G{constructor(){this._initialized=!1,this._initPromise=null,this.config={host:process.env.REDIS_HOST||"localhost",port:parseInt(process.env.REDIS_PORT||"6379"),password:process.env.REDIS_PASSWORD,retryDelayOnFailover:100,enableOfflineQueue:!1,maxRetriesPerRequest:3,lazyConnect:!0,keepAlive:3e4,family:4,keyPrefix:"hive:",enabled:"true"===process.env.REDIS_ENABLED||B},this.stats={hits:0,misses:0,sets:0,deletes:0,errors:0,avgResponseTime:0,memoryUsage:0,activeConnections:0},this._isUsingMockRedis=!0,this._isUsingUpstash=!1,this.client=new F,this._initPromise=this.initializeClient()}async initializeClient(){if(B)try{let a=await E();if(a){this.client=a,this._isUsingMockRedis=!1,this._isUsingUpstash=!0,this._initialized=!0,y.v.info("Using Upstash Redis for caching (distributed)"),this.startHealthCheck();return}}catch(a){y.v.error("Failed to initialize Upstash, falling back to MockRedis",{component:"redis-client"},a instanceof Error?a:void 0)}this.client=new F,this._isUsingMockRedis=!0,this._isUsingUpstash=!1,this._initialized=!0,B?y.v.warn("Upstash configured but failed to connect, using MockRedis fallback"):y.v.info("Using MockRedis for caching (Upstash not configured)"),setTimeout(()=>{this.startHealthCheck()},100)}async ensureInitialized(){!this._initialized&&this._initPromise&&await this._initPromise}startHealthCheck(){this.healthCheckInterval=setInterval(async()=>{try{let a=Date.now();await this.client.ping();let b=Date.now()-a;this.stats.avgResponseTime=(this.stats.avgResponseTime+b)/2;let c=(await this.client.info("memory")).match(/used_memory:(\d+)/);c&&(this.stats.memoryUsage=parseInt(c[1]));let d=(await this.client.info("clients")).match(/connected_clients:(\d+)/);d&&(this.stats.activeConnections=parseInt(d[1]))}catch(a){this.stats.errors++,y.v.error("Redis health check failed",{component:"redis-client"},a instanceof Error?a:void 0)}},3e4)}generateKey(a,b,c="ub-buffalo"){return`${a}:${c}:${b}`}async trackOperation(a,b){let c=Date.now();try{let c=await a;switch(b){case"get":null!==c?this.stats.hits++:this.stats.misses++;break;case"set":this.stats.sets++;break;case"del":this.stats.deletes++}return c}catch(a){throw this.stats.errors++,a}finally{let a=Date.now()-c;this.stats.avgResponseTime=(this.stats.avgResponseTime+a)/2}}async get(a,b,c){let d=this.generateKey(a,b,c);return this.trackOperation(this.client.get(d).then(d=>{if(d)try{let e=JSON.parse(d);if(Date.now()>e.timestamp+1e3*e.ttl)return this.delete(a,b,c),null;return e.data}catch(a){y.v.error("Failed to parse cache entry",{component:"redis-client"},a instanceof Error?a:void 0)}return null}),"get")}async set(a,b,c,d=3600,e,f){let g=this.generateKey(a,b,e),h={data:c,timestamp:Date.now(),ttl:d,version:"1.0.0",campusId:e||"ub-buffalo",metadata:f};return this.trackOperation(this.client.setex(g,d,JSON.stringify(h)).then(a=>"OK"===a),"set")}async delete(a,b,c){let d=this.generateKey(a,b,c);return this.trackOperation(this.client.del(d).then(a=>a>0),"del")}async deletePattern(a,b,c){let d=this.generateKey(a,b,c);try{let a=await this.client.keys(d);if(0===a.length)return 0;let b=await this.client.del(...a);return this.stats.deletes+=b,b}catch(a){return this.stats.errors++,y.v.error("Failed to delete pattern",{component:"redis-client"},a instanceof Error?a:void 0),0}}async exists(a,b,c){let d=this.generateKey(a,b,c);try{let a=await this.client.exists(d);return 1===a}catch{return this.stats.errors++,!1}}async increment(a,b,c=1,d){let e=this.generateKey(a,b,d);try{return await this.client.incrby(e,c)}catch(a){return this.stats.errors++,y.v.error("Failed to increment key",{component:"redis-client"},a instanceof Error?a:void 0),0}}async setWithExpiry(a,b,c,d,e){let f=this.generateKey(a,b,e);try{let a=await this.client.set(f,JSON.stringify(c),"PX",d);if("OK"===a)return this.stats.sets++,!0;return!1}catch(a){return this.stats.errors++,y.v.error("Failed to set with expiry",{component:"redis-client"},a instanceof Error?a:void 0),!1}}async getCampusData(a,b){let c={},d=["ub-buffalo"].map(async d=>{let e=await this.get(a,b,d);e&&(c[d]=e)});return await Promise.all(d),c}async invalidateCampusCache(a){try{let b=`*:${a}:*`,c=await this.client.keys(b);if(0===c.length)return 0;let d=await this.client.del(...c);return this.stats.deletes+=d,y.v.info(`Invalidated ${d} cache entries for campus: ${a}`),d}catch(a){return this.stats.errors++,y.v.error("Failed to invalidate campus cache",{component:"redis-client"},a instanceof Error?a:void 0),0}}async pipeline(){return this.client.pipeline()}isUsingMockRedis(){return this._isUsingMockRedis}isUsingUpstash(){return this._isUsingUpstash}getConnectionType(){return this._isUsingUpstash?"upstash":"mock"}isUpstashConfigured(){return B}async waitForInit(){await this.ensureInitialized()}async mget(a,b,c){let d=b.map(b=>this.generateKey(a,b,c));try{return(await this.client.mget(...d)).map(a=>{if(a)try{let b=JSON.parse(a);if(Date.now()>b.timestamp+1e3*b.ttl)return null;return this.stats.hits++,b.data}catch(a){return y.v.error("Failed to parse cache entry in mget",{component:"redis-client"},a instanceof Error?a:void 0),this.stats.misses++,null}return this.stats.misses++,null})}catch(a){return this.stats.errors++,y.v.error("Failed to execute mget",{component:"redis-client"},a instanceof Error?a:void 0),Array(b.length).fill(null)}}async mset(a){try{let b=this.client.pipeline();a.forEach(({namespace:a,key:c,data:d,ttl:e=3600,campusId:f})=>{let g=this.generateKey(a,c,f),h={data:d,timestamp:Date.now(),ttl:e,version:"1.0.0",campusId:f||"ub-buffalo"};b.setex(g,e,JSON.stringify(h))});let c=await b.exec(),d=c?.every(a=>a&&"OK"===a[0])||!1;return d&&(this.stats.sets+=a.length),d}catch(a){return this.stats.errors++,y.v.error("Failed to execute mset",{component:"redis-client"},a instanceof Error?a:void 0),!1}}getStats(){let a=this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses)*100:0;return{...this.stats,hitRate:parseFloat(a.toFixed(2)),totalOperations:this.stats.hits+this.stats.misses+this.stats.sets+this.stats.deletes}}async getMemoryInfo(){try{let a=(await this.client.info("memory")).split("\r\n"),b={};return a.forEach(a=>{let[c,d]=a.split(":");c&&void 0!==d&&(b[c]=isNaN(Number(d))?d:Number(d))}),b}catch(a){return y.v.error("Failed to get memory info",{component:"redis-client"},a instanceof Error?a:void 0),{}}}async flushAll(){try{return await this.client.flushall(),y.v.warn("Redis cache completely flushed"),!0}catch(a){return this.stats.errors++,y.v.error("Failed to flush cache",{component:"redis-client"},a instanceof Error?a:void 0),!1}}async close(){this.healthCheckInterval&&clearInterval(this.healthCheckInterval);try{await this.client.quit(),y.v.info("Redis client connection closed")}catch(a){y.v.error("Error closing Redis connection",{component:"redis-client"},a instanceof Error?a:void 0)}}async isHealthy(){try{let a=await this.client.ping();return"PONG"===a}catch{return!1}}}let H=new G,I=Date.now();async function J(a){let{searchParams:b}=new URL(a.url),c="true"===b.get("verbose"),d=new Date().toISOString(),e=Math.floor((Date.now()-I)/1e3),[f,g,h]=await Promise.all([K(),L(),M()]),i={firestore:f,auth:g,config:function(){let a=!!(process.env.FIREBASE_PRIVATE_KEY||process.env.FIREBASE_PRIVATE_KEY_BASE64||process.env.FIREBASE_SERVICE_ACCOUNT_KEY),b=["FIREBASE_PROJECT_ID","FIREBASE_CLIENT_EMAIL"].filter(a=>!process.env[a]);if(b.length>0||!a){let c=[...b];return a||c.push("FIREBASE_PRIVATE_KEY (or FIREBASE_PRIVATE_KEY_BASE64 or FIREBASE_SERVICE_ACCOUNT_KEY)"),{status:"fail",message:`Missing env vars: ${c.join(", ")}`}}let c=["JWT_SECRET","NEXT_PUBLIC_FIREBASE_API_KEY"].filter(a=>!process.env[a]);return c.length>0?{status:"warn",message:`Missing recommended vars: ${c.join(", ")}`}:{status:"pass",message:"All required configuration present"}}(),redis:h},j=Object.values(i).every(a=>"pass"===a.status),k=Object.values(i).some(a=>"fail"===a.status),l=j?"healthy":k?"unhealthy":"degraded",m={status:l,timestamp:d,uptime:e,environment:v.hf,version:process.env.npm_package_version||"1.0.0",nodeVersion:process.version,checks:i};c&&(m.details={firebaseConfigured:v.zq,environmentInfo:w.Ov,platform:process.platform});let n="healthy"===l||"degraded"===l?200:503;return u.NextResponse.json(m,{status:n})}async function K(){if(!v.zq)return{status:"fail",message:"Firebase Admin not configured"};let a=Date.now();try{let b=await w.dbAdmin.collection("featureFlags").limit(1).get(),c=Date.now()-a;if(c>500)return{status:"warn",latency:c,message:`High latency: ${c}ms`};return{status:"pass",latency:c,message:`Connected, ${b.size} doc(s) returned`}}catch(b){return{status:"fail",latency:Date.now()-a,message:b instanceof Error?b.message:"Unknown error"}}}async function L(){if(!v.zq)return{status:"fail",message:"Firebase Admin not configured"};let a=Date.now();try{let b=await w.authAdmin.listUsers(1),c=Date.now()-a;return{status:"pass",latency:c,message:`Auth service connected (${b.users.length} user sampled)`}}catch(d){let b=Date.now()-a,c=d instanceof Error?d.message:"Unknown error";if(c.includes("PERMISSION_DENIED"))return{status:"warn",latency:b,message:"Auth service reachable but permission denied for user list"};return{status:"fail",latency:b,message:c}}}async function M(){let a=Date.now();try{let b=await (0,x.g6)();await H.waitForInit();let c=H.getConnectionType(),d=H.isUpstashConfigured(),e=Date.now()-a;if(d||b.enabled)if(b.connected&&"upstash"===c)return{status:"pass",latency:e,message:`Upstash Redis connected (rate limiter: ${b.memoryEntries} fallback entries, cache: ${c})`};else if(b.connected)return{status:"warn",latency:e,message:`Rate limiter using Upstash, cache using ${c} (${b.memoryEntries} memory entries)`};else return{status:"warn",latency:e,message:`Upstash configured but using fallback (${b.memoryEntries}/${b.maxMemoryEntries} memory entries)`};return{status:"warn",latency:e,message:"Using in-memory rate limiting (Upstash not configured). Set UPSTASH_REDIS_REST_URL for distributed rate limiting."}}catch(b){return{status:"fail",latency:Date.now()-a,message:b instanceof Error?b.message:"Redis health check failed"}}}let N=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/health/route",pathname:"/api/health",filename:"route",bundlePath:"app/api/health/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/api/health/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:O,workUnitAsyncStorage:P,serverHooks:Q}=N;function R(){return(0,g.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:P})}async function S(a,b,c){var d;let e="/api/health/route";"/index"===e&&(e="/");let g=await N.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||N.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===N.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,i.getTracer)(),K=J.getActiveScopeSpan(),L={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>N.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},M=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(M,(0,l.signalFromNodeResponse)(b));try{let d=async c=>N.handle(P,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=L.renderOpts.fetchMetrics;let i=L.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=L.renderOpts.collectedTags;if(!E)return await (0,o.I)(M,O,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await N.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await N.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(M,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};K?await g(K):await J.withPropagatedContext(a.headers,()=>J.trace(m.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await N.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(M,O,new Response(null,{status:500})),null}}},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:a=>{a.exports=require("node:crypto")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},97338:(a,b,c)=>{function d(a,b,c){let d=new Date().toISOString(),e=`[${d}] [${a.toUpperCase()}]`;return c&&Object.keys(c).length>0?`${e} ${b} ${JSON.stringify(c)}`:`${e} ${b}`}function e(a){if(!a)return a;let b={...a};for(let a of["password","token","secret","apiKey","authorization"])a in b&&delete b[a],b.metadata&&a in b.metadata&&delete b.metadata[a];return b}async function f(a,b,c,d){}c.d(b,{h:()=>h,v:()=>g});let g={debug(a,b){},info(a,b){},warn(a,b){console.warn(d("warn",a,e(b)))},error(a,b,c){let g,h=c;b instanceof Error?(h=b,g=void 0):g=b;let i=e(g);console.error(d("error",a,i)),h&&console.error("Stack trace:",h.stack),f("error",a,i,h)}};function h(a,b){let c={action:"security_event",component:"security",...b,metadata:{eventType:a,...b.tags,...b.metadata}};"blocked_request"===a||"suspicious_activity"===a||"admin_access"===a?g.warn(`Security event: ${a}`,c):g.info(`Security event: ${a}`,c)}}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[7545,1684,5524,4760,4619],()=>b(b.s=54144));module.exports=c})();