"use strict";(()=>{var a={};a.id=4323,a.ids=[4323],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},2431:(a,b,c)=>{c.d(b,{W4:()=>i,vW:()=>h});var d=c(46675),e=c(38929);let f=new Map;function g(a){return`spaces/${a}/memberCountShards`}async function h(a,b=1){let c=g(a),i=function(){let a=Math.floor(10*Math.random());return`shard_${a}`}(),j=e.dbAdmin.doc(`${c}/${i}`);await j.set({count:d.firestore.FieldValue.increment(b),updatedAt:d.firestore.FieldValue.serverTimestamp()},{merge:!0}),f.delete(a)}function i(){return"true"===process.env.USE_SHARDED_MEMBER_COUNT}},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3893:(a,b,c)=>{c.d(b,{A:()=>e});let d={enabled:!1,level:"normal",hideFromDirectory:!1,hideActivity:!1,hideSpaceMemberships:!1,hideLastSeen:!1,hideOnlineStatus:!1,hideFromSearch:!1};class e{static getSettings(a){let b=a.ghostMode,c=a.visibility;return b?.enabled?{enabled:b.enabled,level:b.level??"normal",hideFromDirectory:b.hideFromDirectory??c?.showInDirectory===!1,hideActivity:b.hideActivity??c?.showActivity===!1,hideSpaceMemberships:b.hideSpaceMemberships??!1,hideLastSeen:b.hideLastSeen??!1,hideOnlineStatus:b.hideOnlineStatus??!1,hideFromSearch:b.hideFromSearch??b.hideFromDirectory??!1}:d}static shouldHideFromDirectory(a,b,c){let d=this.getSettingsFromUser(a);return!!d.enabled&&!!d.hideFromDirectory&&this.applyVisibilityRules(d,a.id,b,c)}static shouldHideActivity(a,b,c){let d=this.getSettingsFromUser(a);return!!d.enabled&&!!d.hideActivity&&this.applyVisibilityRules(d,a.id,b,c)}static shouldHideFromSearch(a,b,c){let d=this.getSettingsFromUser(a);return!!d.enabled&&(!!d.hideFromSearch||!!d.hideFromDirectory)&&this.applyVisibilityRules(d,a.id,b,c)}static shouldHideSpaceMemberships(a,b){let c=this.getSettingsFromUser(a);return!!c.enabled&&!!c.hideSpaceMemberships&&b.userId!==a.id&&!b.isAdmin}static shouldHideOnlineStatus(a,b){let c=this.getSettingsFromUser(a);return!!c.enabled&&!!c.hideOnlineStatus&&b.userId!==a.id}static shouldHideLastSeen(a,b){let c=this.getSettingsFromUser(a);return!!c.enabled&&!!c.hideLastSeen&&b.userId!==a.id}static filterUsers(a,b,c,d){return a.filter(a=>{let e=d?.(a.id);switch(c){case"directory":return!this.shouldHideFromDirectory(a,b,e);case"search":return!this.shouldHideFromSearch(a,b,e);case"activity":return!this.shouldHideActivity(a,b,e);default:return!0}})}static getLevelPreset(a){switch(a){case"invisible":return{hideFromDirectory:!0,hideActivity:!0,hideSpaceMemberships:!0,hideLastSeen:!0,hideOnlineStatus:!0,hideFromSearch:!0};case"minimal":return{hideFromDirectory:!1,hideActivity:!0,hideSpaceMemberships:!1,hideLastSeen:!0,hideOnlineStatus:!0,hideFromSearch:!1};case"selective":return{hideFromDirectory:!1,hideActivity:!1,hideSpaceMemberships:!1,hideLastSeen:!0,hideOnlineStatus:!1,hideFromSearch:!1};default:return{hideFromDirectory:!1,hideActivity:!1,hideSpaceMemberships:!1,hideLastSeen:!1,hideOnlineStatus:!1,hideFromSearch:!1}}}static getSettingsFromUser(a){return a.ghostMode?.enabled?{enabled:a.ghostMode.enabled,level:a.ghostMode.level??"normal",hideFromDirectory:a.ghostMode.hideFromDirectory??!1,hideActivity:a.ghostMode.hideActivity??!1,hideSpaceMemberships:a.ghostMode.hideSpaceMemberships??!1,hideLastSeen:a.ghostMode.hideLastSeen??!1,hideOnlineStatus:a.ghostMode.hideOnlineStatus??!1,hideFromSearch:a.ghostMode.hideFromSearch??a.ghostMode.hideFromDirectory??!1}:d}static applyVisibilityRules(a,b,c,d){if(c.userId===b||c.isAdmin)return!1;switch(a.level){case"invisible":return!0;case"minimal":if(d&&d.length>0)return!1;return!c.memberOfSpaceIds.some(a=>c.memberOfSpaceIds.includes(a));case"selective":if(d&&d.length>=2)return!1;return!0;default:return!1}}}},4573:a=>{a.exports=require("node:buffer")},7879:a=>{a.exports=import("firebase-admin/firestore")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13713:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{handler:()=>x,patchFetch:()=>w,routeModule:()=>y,serverHooks:()=>B,workAsyncStorage:()=>z,workUnitAsyncStorage:()=>A});var e=c(98128),f=c(48869),g=c(78868),h=c(37526),i=c(21884),j=c(261),k=c(24218),l=c(73640),m=c(66376),n=c(36363),o=c(73605),p=c(76583),q=c(19465),r=c(78910),s=c(86439),t=c(48724),u=c(14426),v=a([u]);u=(v.then?(await v)():v)[0];let y=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/spaces/[spaceId]/members/route",pathname:"/api/spaces/[spaceId]/members",filename:"route",bundlePath:"app/api/spaces/[spaceId]/members/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/api/spaces/[spaceId]/members/route.ts",nextConfigOutput:"",userland:u}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:B}=y;function w(){return(0,g.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function x(a,b,c){var d;let e="/api/spaces/[spaceId]/members/route";"/index"===e&&(e="/");let g=await y.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!x){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||y.isDev||x||(G=D,G="/index"===G?"/":G);let H=!0===y.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>y.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>y.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await y.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await y.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await y.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}d()}catch(a){d(a)}})},14276:a=>{a.exports=import("firebase-admin/auth")},14426:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{DELETE:()=>B,GET:()=>y,PATCH:()=>A,POST:()=>z});var e=c(74447);c(73249);var f=c(54760),g=c(38929),h=c(46675),i=c(74285),j=c(70510),k=c(91714),l=c(94205),m=c(25384),n=c(87266),o=c(2431),p=c(81517),q=a([j,l]);[j,l]=q.then?(await q)():q;let u=f.Ik({limit:f.au.number().min(1).max(100).default(50),offset:f.au.number().min(0).default(0),role:f.k5(["owner","admin","moderator","member","guest"]).optional(),search:f.Yj().optional(),includeOffline:f.au.boolean().default(!0)}),v=f.Ik({userId:f.Yj(),role:f.k5(["member","moderator","admin"]).default("member")}),w=f.Ik({userId:f.Yj(),role:f.k5(["member","moderator","admin"]).optional(),action:f.k5(["suspend","unsuspend"]).optional(),reason:f.Yj().optional()}),x=f.Ik({userId:f.Yj(),reason:f.Yj().optional()});async function r(a,b,c){let d=(0,j.SN)(),e=await d.findById(a);if(e.isFailure)return{ok:!1,status:n.t3.NOT_FOUND,message:"Space not found"};let f=e.getValue();if(f.campusId.id!==c)return{ok:!1,status:n.t3.FORBIDDEN,message:"Access denied"};let h=await g.dbAdmin.collection("spaceMembers").where("spaceId","==",a).where("userId","==",b).where("isActive","==",!0).where("campusId","==",c).limit(1).get();return h.empty?f.isPublic?{ok:!0,space:f,membership:{role:"guest"}}:{ok:!1,status:n.t3.FORBIDDEN,message:"Membership required"}:{ok:!0,space:f,membership:h.docs[0].data()}}async function s(a,b,c){let d=await g.dbAdmin.collection("spaceMembers").where("spaceId","==",a).where("userId","==",b).where("isActive","==",!0).where("campusId","==",c).limit(1).get();return d.empty?{ok:!1,status:n.t3.NOT_FOUND,message:"Member not found"}:{ok:!0,membership:d.docs[0].data()}}function t(a){return{saveSpaceMember:async a=>{try{let b=g.dbAdmin.collection("spaceMembers").doc();return await b.set((0,m.Rg)({spaceId:a.spaceId,userId:a.userId,role:a.role,joinedAt:h.firestore.FieldValue.serverTimestamp(),lastActive:h.firestore.FieldValue.serverTimestamp(),isActive:a.isActive,permissions:a.permissions,joinMethod:a.joinMethod,isOnline:!1})),i.Q7.ok()}catch(a){return i.Q7.fail(`Failed to save space member: ${a}`)}},findSpaceMember:async(b,c)=>{try{let d=g.dbAdmin.collection("spaceMembers").where("spaceId","==",b).where("userId","==",c).where("campusId","==",a).limit(1),e=await d.get();if(e.empty)return i.Q7.ok(null);let f=e.docs[0].data();return i.Q7.ok({spaceId:f.spaceId,userId:f.userId,campusId:f.campusId,role:f.role,joinedAt:f.joinedAt?.toDate?.()||new Date,isActive:f.isActive,permissions:f.permissions||["post"],joinMethod:f.joinMethod||"manual"})}catch(a){return i.Q7.fail(`Failed to find member: ${a}`)}},updateSpaceMember:async(b,c,d)=>{try{let e=g.dbAdmin.collection("spaceMembers").where("spaceId","==",b).where("userId","==",c).where("campusId","==",a).limit(1),f=await e.get();if(!f.empty){let a={};void 0!==d.isActive&&(a.isActive=d.isActive),d.role&&(a.role=d.role),d.permissions&&(a.permissions=d.permissions),d.joinedAt&&(a.joinedAt=h.firestore.FieldValue.serverTimestamp()),d.leftAt&&(a.leftAt=h.firestore.FieldValue.serverTimestamp()),d.removedAt&&(a.removedAt=h.firestore.FieldValue.serverTimestamp()),d.removedBy&&(a.removedBy=d.removedBy),void 0!==d.isSuspended&&(a.isSuspended=d.isSuspended),d.suspendedAt&&(a.suspendedAt=h.firestore.FieldValue.serverTimestamp()),d.suspendedBy&&(a.suspendedBy=d.suspendedBy),d.suspensionReason&&(a.suspensionReason=d.suspensionReason),d.unsuspendedAt&&(a.unsuspendedAt=h.firestore.FieldValue.serverTimestamp()),d.unsuspendedBy&&(a.unsuspendedBy=d.unsuspendedBy),a.updatedAt=h.firestore.FieldValue.serverTimestamp(),await f.docs[0].ref.update(a)}return i.Q7.ok()}catch(a){return i.Q7.fail(`Failed to update member: ${a}`)}},updateSpaceMetrics:async(a,b)=>{try{b.memberCountDelta&&(0,o.W4)()&&(await (0,o.vW)(a,b.memberCountDelta),k.vF.debug("[members] Used sharded member counter",{spaceId:a,delta:b.memberCountDelta}));let c=g.dbAdmin.collection("spaces").doc(a),d={updatedAt:h.firestore.FieldValue.serverTimestamp()};return b.memberCountDelta&&!(0,o.W4)()&&(d["metrics.memberCount"]=h.firestore.FieldValue.increment(b.memberCountDelta)),b.activeCountDelta&&(d["metrics.activeMembers"]=h.firestore.FieldValue.increment(b.activeCountDelta)),await c.update(d),i.Q7.ok()}catch(a){return i.Q7.fail(`Failed to update metrics: ${a}`)}}}}let y=(0,l.lT)(async(a,{params:b},c)=>{let d=(0,l.F6)(a),e=(0,l.rE)(a),{spaceId:f}=await b,h=await r(f,d,e);if(!h.ok){let a=h.status===n.t3.NOT_FOUND?"RESOURCE_NOT_FOUND":"FORBIDDEN";return c.error(h.message,a,{status:h.status})}let j=u.parse(Object.fromEntries(new URL(a.url).searchParams.entries())),k=j.role,m=g.dbAdmin.collection("spaceMembers").where("spaceId","==",f).where("isActive","==",!0).where("campusId","==",e);k&&(m=m.where("role","==",k)),m=m.orderBy("joinedAt","desc").offset(j.offset).limit(j.limit);let o=await m.get(),p=[],q=o.docs.map(a=>a.data().userId||a.id),s=q.map(a=>g.dbAdmin.collection("users").doc(a)),t=s.length>0?await g.dbAdmin.getAll(...s):[],v=new Map;t.forEach(a=>{a.exists&&v.set(a.id,a.data())});let w=q.map(a=>g.dbAdmin.collection("presence").doc(a)),x=w.length>0?await g.dbAdmin.getAll(...w):[],y=new Map;x.forEach(a=>{a.exists&&y.set(a.id,a.data())});let z=q.map(a=>g.dbAdmin.collection("privacySettings").doc(a)),A=z.length>0?await g.dbAdmin.getAll(...z):[],B=new Map;A.forEach(a=>{a.exists&&B.set(a.id,a.data())});let C=i.oM.authenticated({userId:d,campusId:e,memberOfSpaceIds:[f]}),D=new Map,E=new Map,F=new Map,G=[];for(let a=0;a<q.length;a+=30){let b=q.slice(a,a+30);G.push(g.dbAdmin.collection("activityEvents").where("userId","in",b).where("spaceId","==",f).where("type","==","post_created").select("userId").get().then(a=>{for(let b of a.docs){let a=b.data().userId;D.set(a,(D.get(a)||0)+1)}})),G.push(g.dbAdmin.collection("reactions").where("authorId","in",b).where("spaceId","==",f).select("authorId").get().then(a=>{for(let b of a.docs){let a=b.data().authorId;E.set(a,(E.get(a)||0)+1)}}).catch(()=>{})),G.push(g.dbAdmin.collection("rsvps").where("userId","in",b).where("status","==","going").select("userId","eventId").get().then(async a=>{let b=[...new Set(a.docs.map(a=>a.data().eventId))];if(0===b.length)return;let c=new Set;for(let a=0;a<b.length;a+=30){let d=b.slice(a,a+30);(await g.dbAdmin.collection("events").where("__name__","in",d).where("spaceId","==",f).select().get()).docs.forEach(a=>c.add(a.id))}for(let b of a.docs){let a=b.data();c.has(a.eventId)&&F.set(a.userId,(F.get(a.userId)||0)+1)}}).catch(()=>{}))}for(let a of(await Promise.all(G),o.docs)){let b=a.data(),c=b.userId||a.id,d=v.get(c);if(!d)continue;let e=B.get(c),g={id:c,ghostMode:e?.ghostMode};if(i.A8.shouldHideFromDirectory(g,C,[f]))continue;let h=D.get(c)||0,k=y.get(c),l=!!k&&("online"===k.status||"away"===k.status)&&!k.isGhostMode,m={id:c,name:d.fullName||d.displayName||"Unknown User",username:d.handle||d.email?.split("@")[0]||"unknown",avatar:d.photoURL,bio:d.bio||d.about,role:b.role||"member",status:l?"online":"offline",joinedAt:b.joinedAt?.toDate?b.joinedAt.toDate():b.joinedAt?new Date(b.joinedAt):new Date,lastActive:b.lastActive?.toDate?b.lastActive.toDate():b.lastActive?new Date(b.lastActive):new Date,isVerified:!!d.isVerified,badges:d.badges||[],stats:{postsCount:h,likesReceived:E.get(c)||0,eventsAttended:F.get(c)||0,contributionScore:10*h+2*(E.get(c)||0)+5*(F.get(c)||0)},interests:d.interests||[],major:d.major,graduationYear:d.graduationYear,location:d.location,socialLinks:d.socialLinks||{},permissions:{canMessage:"guest"!==b.role,canViewProfile:!0,canInviteOthers:["owner","admin","moderator"].includes(b.role)},spaceRole:b.role,isOnline:l};if(j.search){let a=j.search.toLowerCase();if(!((m.name?.toLowerCase()||"").includes(a)||(m.username?.toLowerCase()||"").includes(a)||m.bio&&m.bio.toLowerCase().includes(a)||(m.interests||[]).some(b=>b.toLowerCase().includes(a))))continue}(j.includeOffline||"offline"!==m.status)&&p.push(m)}let H={owner:5,admin:4,moderator:3,member:2,guest:1};p.sort((a,b)=>{let c=(H[b.role]||1)-(H[a.role]||1);return 0!==c?c:"offline"!==a.status&&"offline"===b.status?-1:"offline"===a.status&&"offline"!==b.status?1:new Date(b.joinedAt).getTime()-new Date(a.joinedAt).getTime()});let I=await g.dbAdmin.collection("spaceMembers").where("spaceId","==",f).where("isActive","==",!0).where("campusId","==",e).get(),J=p.filter(a=>"offline"!==a.status).length;return c.success({members:p,summary:{totalMembers:I.size,onlineMembers:J,activeMembers:p.filter(a=>(Date.now()-new Date(a.lastActive).getTime())/864e5<=7).length},pagination:{limit:j.limit,offset:j.offset,hasMore:o.size===j.limit,nextOffset:o.size===j.limit?j.offset+j.limit:null}})}),z=(0,l.SH)(v,async(a,{params:b},c,d)=>{try{let e=(0,l.F6)(a),f=(0,l.rE)(a),{spaceId:h}=await b,i=await r(h,e,f);if(!i.ok){let a=i.status===n.t3.NOT_FOUND?"RESOURCE_NOT_FOUND":"FORBIDDEN";return d.error(i.message,a,{status:i.status})}if(!(await g.dbAdmin.collection("users").doc(c.userId).get()).exists)return d.error("User not found","RESOURCE_NOT_FOUND",{status:n.t3.NOT_FOUND});let m=(0,j.iT)({userId:e,campusId:f},t(f)),o=await m.inviteMember(e,{spaceId:h,targetUserId:c.userId,role:c.role});if(o.isFailure){let a=o.error||"Failed to invite member";if(a.includes("already a member")||a.includes("User is already"))return d.error(a,"CONFLICT",{status:n.t3.CONFLICT});if(a.includes("Insufficient permissions"))return d.error(a,"FORBIDDEN",{status:n.t3.FORBIDDEN});return k.vF.error("Failed to invite member via DDD",{error:a,inviterId:e,spaceId:h,targetUserId:c.userId}),d.error(a,"INTERNAL_ERROR",{status:n.t3.INTERNAL_SERVER_ERROR})}let p=o.getValue().data;return k.vF.info("✅ Member invited via DDD",{inviterId:e,spaceId:h,targetUserId:c.userId,role:p.role,isReactivation:p.isReactivation,endpoint:"/api/spaces/[spaceId]/members"}),d.success({success:!0,message:"Member invited successfully",member:{id:c.userId,role:p.role}})}catch(a){return k.vF.error("Error inviting member at /api/spaces/[spaceId]/members",{error:a instanceof Error?a.message:String(a)}),d.error("Failed to invite member","INTERNAL_ERROR",{status:n.t3.INTERNAL_SERVER_ERROR})}}),A=(0,l.SH)(w,async(a,{params:b},c,d)=>{let e=(0,l.F6)(a),f=(0,l.rE)(a),{spaceId:h}=await b,i=await r(h,e,f);if(!i.ok){let a=i.status===n.t3.NOT_FOUND?"RESOURCE_NOT_FOUND":"FORBIDDEN";return d.error(i.message,a,{status:i.status})}let m=await s(h,c.userId,f);if(!m.ok)return d.error(m.message,m.status===n.t3.NOT_FOUND?"RESOURCE_NOT_FOUND":"FORBIDDEN",{status:m.status});let o=m.membership.role;if(c.role&&c.role!==o){let a=(0,j.iT)({userId:e,campusId:f},t(f)),b=await a.changeMemberRole(e,{spaceId:h,targetUserId:c.userId,newRole:c.role});if(b.isFailure){let a=b.error||"Failed to change role";return a.includes("Only leaders")||a.includes("permission")?d.error(a,"FORBIDDEN",{status:n.t3.FORBIDDEN}):(k.vF.error("Failed to change member role via DDD",{error:a,requesterId:e,spaceId:h,targetUserId:c.userId}),d.error(a,"INTERNAL_ERROR",{status:n.t3.INTERNAL_SERVER_ERROR}))}}if("suspend"===c.action||"unsuspend"===c.action){let a=(0,j.iT)({userId:e,campusId:f},t(f));if("suspend"===c.action){let b=await a.suspendMember(e,{spaceId:h,targetUserId:c.userId,reason:c.reason});if(b.isFailure){let a=b.error||"Failed to suspend member";return a.includes("permission")?d.error(a,"FORBIDDEN",{status:n.t3.FORBIDDEN}):(k.vF.error("Failed to suspend member via DDD",{error:a,requesterId:e,spaceId:h,targetUserId:c.userId}),d.error(a,"INTERNAL_ERROR",{status:n.t3.INTERNAL_SERVER_ERROR}))}}else{let b=await a.unsuspendMember(e,{spaceId:h,targetUserId:c.userId,reason:c.reason});if(b.isFailure){let a=b.error||"Failed to unsuspend member";return a.includes("permission")?d.error(a,"FORBIDDEN",{status:n.t3.FORBIDDEN}):(k.vF.error("Failed to unsuspend member via DDD",{error:a,requesterId:e,spaceId:h,targetUserId:c.userId}),d.error(a,"INTERNAL_ERROR",{status:n.t3.INTERNAL_SERVER_ERROR}))}}}return await g.dbAdmin.collection("spaces").doc(h).collection("activity").add({type:"member_role_changed",performedBy:e,targetUserId:c.userId,details:{oldRole:o,newRole:c.role||o,action:c.action||"role_change",reason:c.reason},timestamp:new Date}),k.vF.info("✅ Member updated via DDD",{requesterId:e,spaceId:h,targetUserId:c.userId,action:c.action||"role_change",oldRole:o,newRole:c.role||o,endpoint:"/api/spaces/[spaceId]/members"}),d.success({message:`Member ${c.action||"updated"} successfully`,updates:{role:c.role||o,action:c.action}})}),B=(0,l.lT)(async(a,{params:b},c)=>{let d=(0,l.F6)(a),e=(0,l.rE)(a),{spaceId:f}=await b,h=x.safeParse(Object.fromEntries(new URL(a.url).searchParams.entries()));if(!h.success)return c.error("User ID is required","INVALID_INPUT",{status:n.t3.BAD_REQUEST});let i=await r(f,d,e);if(!i.ok){let a=i.status===n.t3.NOT_FOUND?"RESOURCE_NOT_FOUND":"FORBIDDEN";return c.error(i.message,a,{status:i.status})}if(i.space){let a=i.space.leaderRequests?.find(a=>a.profileId.id===d&&"pending"===a.status);if(a?.provisionalAccessGranted&&!a.reviewedAt)return c.error("Member removal is disabled while your leader verification is pending. Please wait for verification to complete.","PROVISIONAL_ACCESS_RESTRICTED",{status:n.t3.FORBIDDEN})}let m=(0,j.iT)({userId:d,campusId:e},t(e)),o=await m.removeMember(d,{spaceId:f,targetUserId:h.data.userId,reason:h.data.reason});if(o.isFailure){let a=o.error||"Failed to remove member";return a.includes("Cannot remove")||a.includes("owner")||a.includes("Only owners")||a.includes("Insufficient permissions")?c.error(a,"FORBIDDEN",{status:n.t3.FORBIDDEN}):a.includes("not a member")?c.error(a,"RESOURCE_NOT_FOUND",{status:n.t3.NOT_FOUND}):(k.vF.error("Failed to remove member via DDD",{error:a,requesterId:d,spaceId:f,targetUserId:h.data.userId}),c.error(a,"INTERNAL_ERROR",{status:n.t3.INTERNAL_SERVER_ERROR}))}let p=o.getValue().data;return await g.dbAdmin.collection("spaces").doc(f).collection("activity").add({type:"member_removed",performedBy:d,targetUserId:h.data.userId,details:{removedRole:p.previousRole,reason:h.data.reason},timestamp:new Date}),k.vF.info("✅ Member removed via DDD",{requesterId:d,spaceId:f,targetUserId:h.data.userId,previousRole:p.previousRole,endpoint:"/api/spaces/[spaceId]/members"}),c.success({message:"Member removed successfully"})});(0,p.D)([y,z,A,B]),(0,e.A)(y,"7fe96acae323b04f8204055f0ffa501f11a32ce361",null),(0,e.A)(z,"7f31be3c319eed20382ccebae3604ace1d60b64eeb",null),(0,e.A)(A,"7fca402e3bfae35b773be980a3b421592f9da45a0c",null),(0,e.A)(B,"7f3cb4034e985711bc1289ca57e5b95af08ff8ea7c",null),d()}catch(a){d(a)}})},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},28354:a=>{a.exports=require("util")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46675:a=>{a.exports=require("firebase-admin")},55511:a=>{a.exports=require("crypto")},56990:(a,b,c)=>{c.d(b,{o:()=>e});var d=c(77745);class e extends d.r{get userId(){return this.props.userId}get campusId(){return this.props.campusId}get type(){return this.props.type}get isAdmin(){return this.props.isAdmin}get isModerator(){return this.props.isModerator}get connectionIds(){return this.props.connectionIds}get memberOfSpaceIds(){return this.props.memberOfSpaceIds}get isAuthenticated(){return null!==this.props.userId}constructor(a){super(a)}static anonymous(a){return new e({userId:null,campusId:a,type:"anonymous",isAdmin:!1,isModerator:!1,connectionIds:[],memberOfSpaceIds:[]})}static authenticated(a){let b=a.isAdmin??!1,c=a.isModerator??!1,d="authenticated";return b?d="admin":c&&(d="moderator"),new e({userId:a.userId,campusId:a.campusId,type:d,isAdmin:b,isModerator:c,connectionIds:a.connectionIds??[],memberOfSpaceIds:a.memberOfSpaceIds??[]})}static fromAuthContext(a,b){return e.authenticated({userId:a.userId,campusId:a.campusId??"ub-buffalo",isAdmin:a.isAdmin,connectionIds:b?.connectionIds,memberOfSpaceIds:b?.memberOfSpaceIds})}isConnectedTo(a){return this.props.connectionIds.includes(a)}isMemberOf(a){return this.props.memberOfSpaceIds.includes(a)}canViewUserContent(a,b){if(this.props.isAdmin||this.props.userId===a)return!0;switch(b){case"public":return!0;case"campus_only":return this.isAuthenticated;case"connections_only":return this.isConnectedTo(a);default:return!1}}canViewPrivateSpace(a){return!!this.props.isAdmin||this.isMemberOf(a)}canModerateContent(){return this.props.isAdmin||this.props.isModerator}canViewHiddenContent(){return this.props.isAdmin||this.props.isModerator}canViewDeletedContent(){return this.props.isAdmin}getRelationshipTo(a){return this.isAuthenticated?this.isConnectedTo(a)?"connection":"campus":"public"}withConnections(a){return new e({...this.props,connectionIds:[...new Set([...this.props.connectionIds,...a])]})}withSpaceMemberships(a){return new e({...this.props,memberOfSpaceIds:[...new Set([...this.props.memberOfSpaceIds,...a])]})}}},57975:a=>{a.exports=require("node:util")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73249:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{decryptActionBoundArgs:function(){return s},encryptActionBoundArgs:function(){return r}}),c(85037);let d=c(41210),e=c(62521),f=c(86062),g=c(87189),h=c(63033),i=c(10786),j=function(a){return a&&a.__esModule?a:{default:a}}(c(95579)),k=new TextEncoder,l=new TextDecoder,m=void 0,n=void 0;async function o(a,b){let c=await (0,g.getActionEncryptionKey)();if(void 0===c)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let d=atob(b),e=d.slice(0,16),f=d.slice(16),h=l.decode(await (0,g.decrypt)(c,(0,g.stringToUint8Array)(e),(0,g.stringToUint8Array)(f)));if(!h.startsWith(a))throw Object.defineProperty(Error("Invalid Server Action payload: failed to decrypt."),"__NEXT_ERROR_CODE",{value:"E191",enumerable:!1,configurable:!0});return h.slice(a.length)}async function p(a,b){let c=await (0,g.getActionEncryptionKey)();if(void 0===c)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let d=new Uint8Array(16);h.workUnitAsyncStorage.exit(()=>crypto.getRandomValues(d));let e=(0,g.arrayBufferToString)(d.buffer),f=await (0,g.encrypt)(c,d,k.encode(a+b));return btoa(e+(0,g.arrayBufferToString)(f))}var q=function(a){return a[a.Ready=0]="Ready",a[a.Pending=1]="Pending",a[a.Complete=2]="Complete",a}(q||{});let r=j.default.cache(async function a(b,...c){let e=h.workUnitAsyncStorage.getStore(),j=e?(0,h.getCacheSignal)(e):void 0,{clientModules:k}=(0,g.getClientReferenceManifestForRsc)(),l=Error();Error.captureStackTrace(l,a);let n=!1,o=e?(0,i.createHangingInputAbortSignal)(e):void 0,q=0;function r(){0===q&&(q=1,null==j||j.beginRead())}function s(){1===q&&(null==j||j.endRead()),q=2}o&&j&&o.addEventListener("abort",r,{once:!0});let t=await (0,f.streamToString)((0,d.renderToReadableStream)(c,k,{filterStackFrame:m,signal:o,onError(a){(null==o||!o.aborted)&&(n||(n=!0,l.message=a instanceof Error?a.message:String(a)))}}),o);if(n)throw s(),l;if(!e)return p(b,t);r();let u=(0,h.getPrerenderResumeDataCache)(e),v=(0,h.getRenderResumeDataCache)(e),w=b+t,x=(null==u?void 0:u.encryptedBoundArgs.get(w))??(null==v?void 0:v.encryptedBoundArgs.get(w));if(x)return x;let y=await p(b,t);return s(),null==u||u.encryptedBoundArgs.set(w,y),y});async function s(a,b){let c,d=await b,f=h.workUnitAsyncStorage.getStore();if(f){let b=(0,h.getCacheSignal)(f),e=(0,h.getPrerenderResumeDataCache)(f),g=(0,h.getRenderResumeDataCache)(f);(c=(null==e?void 0:e.decryptedBoundArgs.get(d))??(null==g?void 0:g.decryptedBoundArgs.get(d)))||(null==b||b.beginRead(),c=await o(a,d),null==b||b.endRead(),null==e||e.decryptedBoundArgs.set(d,c))}else c=await o(a,d);let{edgeRscModuleMapping:i,rscModuleMapping:j}=(0,g.getClientReferenceManifestForRsc)();return await (0,e.createFromReadableStream)(new ReadableStream({start(a){switch(a.enqueue(k.encode(c)),null==f?void 0:f.type){case"prerender":case"prerender-runtime":f.renderSignal.aborted?a.close():f.renderSignal.addEventListener("abort",()=>a.close(),{once:!0});break;case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"request":case"cache":case"private-cache":case"unstable-cache":case void 0:return a.close()}}}),{findSourceMapURL:n,serverConsumerManifest:{moduleLoading:null,moduleMap:j,serverModuleMap:(0,g.getServerModuleMap)()}})}},74285:(a,b,c)=>{c.d(b,{A8:()=>d.A,Q7:()=>e.Q,oM:()=>f.o});var d=c(3893),e=c(19789),f=c(56990)},74447:(a,b,c)=>{Object.defineProperty(b,"A",{enumerable:!0,get:function(){return d.registerServerReference}});let d=c(41210)},77598:a=>{a.exports=require("node:crypto")},81517:(a,b)=>{function c(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(b,"D",{enumerable:!0,get:function(){return c}})},84200:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{"7f31be3c319eed20382ccebae3604ace1d60b64eeb":()=>e.POST,"7f3cb4034e985711bc1289ca57e5b95af08ff8ea7c":()=>e.DELETE,"7fca402e3bfae35b773be980a3b421592f9da45a0c":()=>e.PATCH,"7fe96acae323b04f8204055f0ffa501f11a32ce361":()=>e.GET});var e=c(14426),f=a([e]);e=(f.then?(await f)():f)[0],d()}catch(a){d(a)}})},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")}};var b=require("../../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[7545,1684,5524,2845,4760,6402,3272,2269,4205,5384,6513,4918,3928,510],()=>b(b.s=13713));module.exports=c})();