"use strict";(()=>{var a={};a.id=8084,a.ids=[8084],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},2431:(a,b,c)=>{c.d(b,{W4:()=>i,vW:()=>h});var d=c(46675),e=c(38929);let f=new Map;function g(a){return`spaces/${a}/memberCountShards`}async function h(a,b=1){let c=g(a),i=function(){let a=Math.floor(10*Math.random());return`shard_${a}`}(),j=e.dbAdmin.doc(`${c}/${i}`);await j.set({count:d.firestore.FieldValue.increment(b),updatedAt:d.firestore.FieldValue.serverTimestamp()},{merge:!0}),f.delete(a)}function i(){return"true"===process.env.USE_SHARDED_MEMBER_COUNT}},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:a=>{a.exports=require("node:buffer")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14276:a=>{a.exports=import("firebase-admin/auth")},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27810:(a,b,c)=>{c.d(b,{Ac:()=>l,Bf:()=>k,Qw:()=>j,ZD:()=>n,mB:()=>m,ng:()=>o});var d=c(38929),e=c(35263),f=c(97338);async function g(a,b={}){let c,{maxRetries:d=3,baseDelayMs:e=100,maxDelayMs:h=2e3,operationName:i="operation"}=b;for(let b=0;b<=d;b++)try{return await a()}catch(k){if(c=k instanceof Error?k:Error(String(k)),b===d||!(c.message.includes("DEADLINE_EXCEEDED")||c.message.includes("UNAVAILABLE")||c.message.includes("RESOURCE_EXHAUSTED")||c.message.includes("INTERNAL")||c.message.includes("ECONNRESET")||c.message.includes("timeout")))break;let a=e*Math.pow(2,b),g=.3*Math.random()*a,j=Math.min(a+g,h);f.v.debug(`Retrying ${i} after ${Math.round(j)}ms (attempt ${b+1}/${d})`,{component:"handle-service",error:c.message}),await new Promise(a=>setTimeout(a,j))}throw c}let h="development"===e.hf,i=new Set(["admin","administrator","root","system","api","www","mail","email","support","help","info","contact","about","terms","privacy","legal","security","safety","abuse","spam","test","testing","dev","development","staging","prod","production","demo","example","sample","null","undefined","true","false","none","empty","blank","default","config","settings","profile","account","user","users","public","private","internal","external","guest","anonymous","unknown","temp","temporary","delete","remove","banned","blocked","suspended","hive","hivecampus","campus"]);function j(a){if(!a||"string"!=typeof a)return{isAvailable:!1,error:"Handle is required"};let b=a.toLowerCase().trim();return b.length<3?{isAvailable:!1,error:"Handle must be at least 3 characters long"}:b.length>20?{isAvailable:!1,error:"Handle must be at most 20 characters long"}:/^[a-zA-Z0-9._-]+$/.test(b)?b.startsWith("_")||b.endsWith("_")?{isAvailable:!1,error:"Handle cannot start or end with underscore"}:b.startsWith(".")||b.endsWith(".")?{isAvailable:!1,error:"Handle cannot start or end with period"}:b.startsWith("-")||b.endsWith("-")?{isAvailable:!1,error:"Handle cannot start or end with hyphen"}:/__+/.test(b)||/\.\.+/.test(b)||/--+/.test(b)?{isAvailable:!1,error:"Handle cannot contain consecutive special characters"}:i.has(b)?{isAvailable:!1,error:"This handle is reserved and cannot be used"}:{isAvailable:!0,normalizedHandle:b}:{isAvailable:!1,error:"Handle can only contain letters, numbers, periods, underscores, and hyphens"}}async function k(a,b){let c=j(b);if(!c.isAvailable)return c;let e=c.normalizedHandle;try{let[b,c]=await Promise.all([a.get(d.dbAdmin.collection("users").where("handle","==",e).limit(1)),a.get(d.dbAdmin.collection("handles").doc(e))]);if(!b.empty||c.exists)return{isAvailable:!1,error:"This handle is already taken",normalizedHandle:e};return{isAvailable:!0,normalizedHandle:e}}catch(a){return f.v.error("Error checking handle availability",{component:"handle-service"},a instanceof Error?a:void 0),{isAvailable:!1,error:"Unable to verify handle availability. Please try again."}}}function l(a,b,c,e){let f=new Date;a.set(d.dbAdmin.collection("handles").doc(b),{userId:c,userEmail:e,reservedAt:f,handle:b})}async function m(a){let b=j(a);if(!b.isAvailable)return b;let c=b.normalizedHandle;if(h||!d.Gg)return f.v.debug("Development mode: Skipping Firestore handle check",{component:"handle-service",handle:c}),{isAvailable:!0,normalizedHandle:c};try{let a=await g(async()=>{let[a,b]=await Promise.all([d.dbAdmin.collection("users").where("handle","==",c).limit(1).get(),d.dbAdmin.collection("handles").doc(c).get()]);return{userQuery:a,handleDoc:b}},{operationName:"checkHandleAvailability",maxRetries:3});if(!a.userQuery.empty||a.handleDoc.exists)return{isAvailable:!1,error:"This handle is already taken",normalizedHandle:c};return{isAvailable:!0,normalizedHandle:c}}catch(a){if(f.v.error("Error checking handle availability",{component:"handle-service"},a instanceof Error?a:void 0),h)return f.v.debug("Development mode: Allowing handle due to Firebase unavailability",{component:"handle-service"}),{isAvailable:!0,normalizedHandle:c};return{isAvailable:!1,error:"Unable to verify handle availability. Please try again."}}}async function n(a,b){let c=j(b);if(!c.isAvailable)return{success:!1,error:c.error};let e=c.normalizedHandle;if(h||!d.Gg)return f.v.debug("Development mode: Skipping handle change transaction",{component:"handle-service"}),{success:!0};try{return await d.dbAdmin.runTransaction(async b=>{let c=d.dbAdmin.collection("users").doc(a),f=await b.get(c);if(!f.exists)return{success:!1,error:"User not found"};let g=f.data(),h=g.handle;if(h===e)return{success:!0};let i=g.handleChangeCount||0,j=g.lastHandleChange;if(i>0&&j){let a=(j.toMillis?j.toMillis():new Date(j).getTime())+15552e6;if(Date.now()<a){let b=new Date(a);return{success:!1,error:`Handle can only be changed once every 6 months. Next change available on ${b.toLocaleDateString()}`,nextChangeDate:b}}}let l=await k(b,e);if(!l.isAvailable)return{success:!1,error:l.error||"Handle is not available"};if(h){let a=d.dbAdmin.collection("handles").doc(h);b.delete(a)}let m=d.dbAdmin.collection("handles").doc(e);b.set(m,{userId:a,userEmail:g.email,reservedAt:new Date,handle:e});let n={handle:e,lastHandleChange:new Date,handleChangeCount:(i||0)+1,updatedAt:new Date};return h&&(n.handleHistory=[...g.handleHistory||[],{handle:h,changedAt:new Date}]),b.update(c,n),{success:!0}})}catch(a){return f.v.error("Error changing handle",{component:"handle-service"},a instanceof Error?a:void 0),{success:!1,error:"Unable to change handle. Please try again."}}}async function o(a){if(h||!d.Gg)return{canChange:!0,changeCount:0,isFirstChangeFree:!0};try{let b=await g(()=>d.dbAdmin.collection("users").doc(a).get(),{operationName:"getHandleChangeStatus",maxRetries:3});if(!b.exists)return{canChange:!1,changeCount:0,isFirstChangeFree:!0};let c=b.data(),e=c.handleChangeCount||0,f=c.lastHandleChange;if(0===e)return{canChange:!0,changeCount:0,isFirstChangeFree:!0};if(f){let a=(f.toMillis?f.toMillis():new Date(f).getTime())+15552e6;if(Date.now()<a)return{canChange:!1,nextChangeDate:new Date(a),changeCount:e,isFirstChangeFree:!1}}return{canChange:!0,changeCount:e,isFirstChangeFree:!1}}catch(b){return f.v.error("Error getting handle change status",{component:"handle-service",userId:a},b instanceof Error?b:void 0),{canChange:!1,changeCount:0,isFirstChangeFree:!0}}}},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},40719:(a,b,c)=>{c.d(b,{qN:()=>f});var d=c(42113);let e={auth:d.Ih,authStrict:d.hC,apiGeneral:d.qM,api:d.qM,strict:d.hC,aiGeneration:d.Wj,search:d.M6,chat:d.gh};async function f(a,b){let c=function(a){let b=a.headers.get("x-forwarded-for"),c=a.headers.get("x-real-ip"),d=a.headers.get("cf-connecting-ip");if(d)return d.trim();if(c)return c.trim();if(b){let a=b.split(",")[0];return a?.trim()||"anonymous"}return"anonymous"}(b),f=(e[a]||d.qM).check(c);return f.success?{allowed:!0,headers:{"X-RateLimit-Limit":String(f.limit),"X-RateLimit-Remaining":String(f.remaining),"X-RateLimit-Reset":String(f.resetTime)}}:{allowed:!1,error:"Rate limit exceeded. Please try again later.",status:429,headers:{"Retry-After":String(f.retryAfter||60),"X-RateLimit-Limit":String(f.limit),"X-RateLimit-Remaining":String(f.remaining),"X-RateLimit-Reset":String(f.resetTime)}}}},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46675:a=>{a.exports=require("firebase-admin")},55511:a=>{a.exports=require("crypto")},56651:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{POST:()=>s});var e=c(73641),f=c(54760),g=c(46675),h=c(94205),i=c(38929),j=c(93272),k=c(27810),l=c(97338),m=c(74820),n=c(40719),o=c(2431),p=a([h]);h=(p.then?(await p)():p)[0];let q=j.Op.isDevelopment&&!i.Gg&&"true"===process.env.DEV_AUTH_BYPASS,r=f.Ik({fullName:m.mQ.name,userType:f.k5(["student","alumni","faculty"]),firstName:f.Yj().max(50).optional(),lastName:f.Yj().max(50).optional(),major:f.Yj().min(1).max(100),graduationYear:f.ai().int().min(1950).max(new Date().getFullYear()+10),handle:m.mQ.handle,avatarUrl:m.mQ.url.optional(),interests:f.YO(f.Yj().max(50)).max(20).optional(),builderRequestSpaces:f.YO(m.mQ.id).max(10).optional(),consentGiven:f.zM().refine(a=>!0===a,"Consent is required"),academicLevel:f.k5(["undergraduate","graduate","doctoral"]).optional(),bio:f.Yj().max(200).optional(),livingSituation:f.k5(["on-campus","off-campus","commuter","not-sure"]).optional(),isLeader:f.zM().optional(),initialSpaceIds:f.YO(m.mQ.id).max(20).optional()}).refine(a=>{let b=new Date().getFullYear();return"student"!==a.userType||a.graduationYear>=b},{message:"Students must have a current or future graduation year",path:["graduationYear"]}),s=(0,h.SH)(r,async(a,b,c,d)=>{let f=await (0,n.qN)("authStrict",a);if(!f.allowed)return l.v.warn("Complete-onboarding rate limit exceeded",{component:"complete-onboarding",ip:a.headers.get("x-forwarded-for")||"unknown"}),h.uf.error(f.error||"Too many attempts. Please try again later.","RATE_LIMITED",{status:f.status});let m=(0,h.F6)(a),p=await (0,j.Ht)(a);if(!p)return h.uf.error("Session not found","UNAUTHORIZED",{status:401});let r=p.campusId||"ub-buffalo",s=p.email,t=p.isAdmin||!1,u=c.handle.toLowerCase().trim();if(q){l.v.warn("DEV MODE: Skipping Firestore transaction for onboarding",{userId:m,handle:u,campusId:r,endpoint:"/api/auth/complete-onboarding"});let a=(0,k.Qw)(u);if(!a.isAvailable)return h.uf.error(a.error||"Invalid handle format","BAD_REQUEST",{status:400});let b=await (0,j.jw)({userId:m,email:s||"",campusId:r,isAdmin:t,onboardingCompleted:!0}),d=e.NextResponse.json({success:!0,user:{id:m,email:s,handle:u,fullName:c.fullName,onboardingCompleted:!0},devMode:!0,message:"Onboarding completed in development mode (no Firestore)"});return(0,j.$G)(d,b,{isAdmin:t}),d}if(!i.Gg)return l.v.error("Firebase not configured and DEV_AUTH_BYPASS not enabled",{component:"complete-onboarding",nodeEnv:"production"}),h.uf.error("Service unavailable. Please try again later.","SERVICE_UNAVAILABLE",{status:503});let v=[];try{await i.dbAdmin.runTransaction(async a=>{let b=await (0,k.Bf)(a,u);if(!b.isAvailable)throw Error(b.error||"Handle is not available");let d=i.dbAdmin.collection("users").doc(m),e=await a.get(d);if(e.exists){let a=e.data();if(a?.campusId&&a.campusId!==r)throw Error("Campus mismatch - cannot complete onboarding for different campus")}(0,k.Ac)(a,u,m,s||"");let f="alumni"===c.userType||"faculty"===c.userType,h=f?new Date(Date.now()+5184e6).toISOString():null;if(a.set(d,{fullName:c.fullName,firstName:c.firstName||c.fullName.split(" ")[0]||"",lastName:c.lastName||c.fullName.split(" ").slice(1).join(" ")||"",handle:u,email:s||"",major:c.major,graduationYear:c.graduationYear,academicLevel:c.academicLevel||function(a,b){let c=new Date().getFullYear(),d=b-c,e=a.toLowerCase();return["mba","phd","masters","md","jd","law","mfa","mph","msw","ms ","ma "].some(a=>e.includes(a))?d>4?"doctoral":"graduate":["doctoral","doctorate","phd"].some(a=>e.includes(a))||d>5?"doctoral":"undergraduate"}(c.major,c.graduationYear),bio:c.bio||null,interests:c.interests||[],livingSituation:c.livingSituation||null,userType:c.userType,isLeader:c.isLeader||!1,...f&&{earlyAccess:!0,earlyAccessExpiresAt:h,earlyAccessGrantedAt:new Date().toISOString()},campusId:r,schoolId:r,onboardingCompleted:!0,onboardingComplete:!0,onboardingCompletedAt:new Date().toISOString(),isActive:!0,updatedAt:new Date().toISOString(),createdAt:e.exists?e.data()?.createdAt:new Date().toISOString(),...c.avatarUrl&&{avatarUrl:c.avatarUrl,profileImageUrl:c.avatarUrl}},{merge:!0}),c.isLeader&&c.builderRequestSpaces&&c.builderRequestSpaces.length>0)for(let b of c.builderRequestSpaces){let d=i.dbAdmin.collection("builderRequests").doc(`${m}-${b}`);a.set(d,{userId:m,spaceId:b,campusId:r,status:"pending",requestedAt:new Date().toISOString(),userHandle:u,userName:c.fullName},{merge:!0})}if(c.initialSpaceIds&&c.initialSpaceIds.length>0)for(let b of c.initialSpaceIds){let c=i.dbAdmin.collection("spaceMembers").doc(`${b}-${m}`),d=await a.get(c),e=!d.exists;if(a.set(c,{odcId:`${b}-${m}`,odcRefs:{spaceId:b,userId:m},userId:m,spaceId:b,campusId:r,role:"member",joinedAt:d.exists?d.data()?.joinedAt:new Date().toISOString(),isActive:!0,permissions:["post","comment","react"],joinMethod:"onboarding"},{merge:!0}),e&&!(0,o.W4)()){let c=i.dbAdmin.collection("spaces").doc(b);a.update(c,{"metrics.memberCount":g.firestore.FieldValue.increment(1),updatedAt:new Date().toISOString()})}e&&v.push(b)}}),(0,o.W4)()&&v.length>0&&(await Promise.all(v.map(a=>(0,o.vW)(a,1))),l.v.debug("[complete-onboarding] Updated sharded member counters",{spaceIds:v,count:v.length})),l.v.info("Onboarding completed successfully",{userId:m,handle:u,campusId:r,endpoint:"/api/auth/complete-onboarding"});let a=await (0,j.jw)({userId:m,email:s||"",campusId:r,isAdmin:t,onboardingCompleted:!0}),b=e.NextResponse.json({success:!0,user:{id:m,email:s,onboardingCompleted:!0}});return(0,j.$G)(b,a,{isAdmin:t}),b}catch(b){let a=b instanceof Error?b.message:"Failed to complete onboarding";if(l.v.error("Onboarding failed",{error:{error:b instanceof Error?b.message:String(b)},userId:m,handle:u,endpoint:"/api/auth/complete-onboarding"}),a.includes("Handle")||a.includes("handle"))return h.uf.error(a,"CONFLICT",{status:409});return h.uf.error(a,"INTERNAL_ERROR",{status:500})}});d()}catch(a){d(a)}})},56793:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{handler:()=>x,patchFetch:()=>w,routeModule:()=>y,serverHooks:()=>B,workAsyncStorage:()=>z,workUnitAsyncStorage:()=>A});var e=c(98128),f=c(48869),g=c(78868),h=c(37526),i=c(21884),j=c(261),k=c(24218),l=c(73640),m=c(66376),n=c(36363),o=c(73605),p=c(76583),q=c(19465),r=c(78910),s=c(86439),t=c(48724),u=c(56651),v=a([u]);u=(v.then?(await v)():v)[0];let y=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/auth/complete-onboarding/route",pathname:"/api/auth/complete-onboarding",filename:"route",bundlePath:"app/api/auth/complete-onboarding/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/api/auth/complete-onboarding/route.ts",nextConfigOutput:"",userland:u}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:B}=y;function w(){return(0,g.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function x(a,b,c){var d;let e="/api/auth/complete-onboarding/route";"/index"===e&&(e="/");let g=await y.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!x){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||y.isDev||x||(G=D,G="/index"===G?"/":G);let H=!0===y.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>y.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>y.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await y.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await y.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await y.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}d()}catch(a){d(a)}})},57975:a=>{a.exports=require("node:util")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74820:(a,b,c)=>{c.d(b,{BH:()=>i,mQ:()=>h,ty:()=>k,xm:()=>j});var d=c(54760),e=c(91714),f=c(35263);let g={SQL_INJECTION:[/(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION)\b)/i,/(--|;|\|\||\/\*|\*\/)/,/(\b(OR|AND)\s+\d+\s*=\s*\d+)/i,/(CONCAT\s*\(|CHAR\s*\()/i],XSS:[/<script[^>]*>.*?<\/script>/gi,/<iframe[^>]*>.*?<\/iframe>/gi,/javascript\s*:/gi,/on\w+\s*=\s*["'][^"']*["']/gi,/<img[^>]+src\s*=\s*["']javascript:/gi],NOSQL_INJECTION:[/\$where/i,/\$regex/i,/\$ne/i,/\$gt/i,/\$lt/i,/\$or/i,/\$and/i,/\$not/i],PATH_TRAVERSAL:[/\\.\\.[/\\\\]/,/[/\\\\]\\.\\.[/\\\\]/,/%2e%2e[/\\\\]/i,/%252e%252e/i],COMMAND_INJECTION:[/(\||&|;|`|\$\(|\${)/,/(wget|curl|nc|netcat|ping|nslookup)/i,/(rm|del|format|shutdown)/i],EMAIL_INJECTION:[/(bcc\s*:|cc\s*:|to\s*:|from\s*:)/i,/\r|\n/,/%0d|%0a|%0D|%0A/i]},h={email:d.Yj().min(1,"Email is required").max(254,"Email too long").email("Invalid email format").refine(a=>!g.EMAIL_INJECTION.some(b=>b.test(a)),"Invalid email format").refine(a=>{let b=a.split("@")[1];return!!b&&/^[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9](?:\.[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])*$/.test(b)},"Invalid email domain"),handle:d.Yj().min(3,"Handle must be at least 3 characters").max(30,"Handle must be at most 30 characters").regex(/^[a-zA-Z0-9_-]+$/,"Handle can only contain letters, numbers, underscores, and hyphens").refine(a=>!["admin","root","api","www","mail","ftp","localhost","test","dev","staging","production","app","web","system","support","help","info","contact","about","null","undefined","void","anonymous"].includes(a.toLowerCase()),"Handle is reserved").transform(a=>a.toLowerCase()),name:d.Yj().min(1,"Name is required").max(100,"Name too long").regex(/^[a-zA-Z\s\-'.]+$/,"Name contains invalid characters").refine(a=>![/<[^>]*>/,/javascript:/i,/data:/i,/vbscript:/i].some(b=>b.test(a)),"Name contains invalid content"),textContent:d.Yj().max(5e3,"Content too long").refine(a=>!g.XSS.some(b=>b.test(a)),"Content contains invalid markup").refine(a=>(a.match(/[<>'"&%$#@!]/g)||[]).length/a.length<.1,"Content has suspicious character patterns"),url:d.Yj().url("Invalid URL format").refine(a=>{try{let b=new URL(a);return["http:","https:"].includes(b.protocol)}catch{return!1}},"Only HTTP and HTTPS URLs are allowed").refine(a=>!["localhost","127.0.0.1","0.0.0.0","192.168.","10.","172."].some(b=>a.includes(b)),"URL not allowed"),filePath:d.Yj().max(255,"File path too long").refine(a=>!g.PATH_TRAVERSAL.some(b=>b.test(a)),"Invalid file path").refine(a=>/^[a-zA-Z0-9/_\-.]+$/.test(a),"File path contains invalid characters"),searchQuery:d.Yj().min(1,"Search query required").max(200,"Search query too long").refine(a=>!g.SQL_INJECTION.some(b=>b.test(a)),"Invalid search query").refine(a=>!g.NOSQL_INJECTION.some(b=>b.test(a)),"Invalid search query"),id:d.Yj().min(1,"ID is required").max(50,"ID too long").regex(/^[a-zA-Z0-9_-]+$/,"ID contains invalid characters"),phone:d.Yj().regex(/^\+?[1-9]\d{1,14}$/,"Invalid phone number format").refine(a=>{let b=a.replace(/[\s\-().]/g,"");return b.length>=10&&b.length<=15},"Phone number length invalid"),password:d.Yj().min(8,"Password must be at least 8 characters").max(128,"Password too long").refine(a=>{let b=/[a-z]/.test(a),c=/[A-Z]/.test(a),d=/\d/.test(a);return b&&c&&d},"Password must contain uppercase, lowercase, and number"),token:d.Yj().min(10,"Token too short").max(500,"Token too long").regex(/^[a-zA-Z0-9._-]+$/,"Token contains invalid characters").refine(a=>"production"!==f.hf||!["test-token","dev-token","development-token","bypass-token","admin-token","debug-token","DEV_MODE"].includes(a),"Invalid token format")};class i{static scanInput(a,b="general"){let c=[],d="safe";if(Object.entries(g).forEach(([b,e])=>{e.some(b=>b.test(a))&&(c.push(b.toLowerCase()),d="XSS"===b||"SQL_INJECTION"===b?"dangerous":"suspicious")}),a.length>1e4&&(c.push("excessive_length"),d="suspicious"),/%[0-9a-f]{2}/i.test(a)){let e=decodeURIComponent(a);e!==a&&"safe"!==this.scanInput(e,b).level&&(c.push("encoded_attack"),d="dangerous")}let e=this.sanitizeInput(a);return{level:d,threats:c,sanitized:e}}static sanitizeInput(a){return a.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/<iframe[^>]*>.*?<\/iframe>/gi,"").replace(/javascript\s*:/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/[\p{C}]/gu,"").trim()}}async function j(a,b,c){try{let d="safe",f=[],g={};if("object"==typeof a&&null!==a)for(let[b,c]of Object.entries(a))if("string"==typeof c){let a=i.scanInput(c,b);g[b]=a.sanitized,"dangerous"===a.level?d="dangerous":"suspicious"===a.level&&"dangerous"!==d&&(d="suspicious"),f.push(...a.threats)}else g[b]=c;"safe"!==d&&await (0,e.h4)("invalid_token",{operation:`suspicious_input_${c.operation}`,tags:{securityLevel:d,threats:f.join(","),userId:c.userId||"anonymous",ip:c.ip||"unknown"}});let h=b.safeParse(a);if(h.success)return{success:!0,data:h.data,securityLevel:d,sanitized:g};{let a=h.error.errors.map(a=>({field:a.path.join("."),message:a.message,code:a.code}));return{success:!1,errors:a,securityLevel:d,sanitized:g}}}catch(a){return e.vF.error("Validation error",{component:"secure-input-validation"},a instanceof Error?a:void 0),{success:!1,errors:[{field:"general",message:"Validation failed",code:"VALIDATION_ERROR"}],securityLevel:"dangerous"}}}let k={magicLinkRequest:d.Ik({email:h.email,redirectTo:h.url.optional()}),magicLinkVerify:d.Ik({token:h.token,email:h.email.optional()}),userRegistration:d.Ik({email:h.email,handle:h.handle,name:h.name,phone:h.phone.optional()}),userUpdate:d.Ik({name:h.name.optional(),handle:h.handle.optional(),bio:h.textContent.optional()}),postCreation:d.Ik({title:d.Yj().min(1).max(200).refine(a=>!g.XSS.some(b=>b.test(a)),"Title contains invalid markup"),content:h.textContent,spaceId:h.id,tags:d.YO(d.Yj().max(50)).max(10).optional()}),spaceCreation:d.Ik({name:h.name,handle:h.handle,description:h.textContent.optional(),isPrivate:d.zM().default(!1)}),search:d.Ik({query:h.searchQuery,type:d.k5(["users","spaces","posts"]).default("posts"),limit:d.ai().min(1).max(50).default(20)})}},77598:a=>{a.exports=require("node:crypto")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[7545,1684,5524,2845,4760,3272,2269,4205],()=>b(b.s=56793));module.exports=c})();