(()=>{var a={};a.id=5852,a.ids=[625,5852],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6237:(a,b,c)=>{"use strict";let d;c.d(b,{C8:()=>i.C8,Eb:()=>p,Ge:()=>n,IG:()=>m,Sj:()=>i.Sj,ai:()=>q,db:()=>l,j2:()=>k,oc:()=>i.oc,yA:()=>d});var e=c(48591),f=c(18553),g=c(69237),h=c(93650);c(57532);var i=c(14428);let j={apiKey:"AIzaSyDMDHXJ8LcWGXz05ipPTNvA-fRi9nfdzbQ",authDomain:"hive-9265c.firebaseapp.com",projectId:"hive-9265c",storageBucket:"hive-9265c.appspot.com",messagingSenderId:"573191826528",appId:"1:573191826528:web:1d5eaeb8531276e4c1a705",measurementId:"G-NK3E12MSFD"};{let a=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"].filter(a=>!j[a]);if(a.length>0)throw console.error(`Missing Firebase environment variables: ${a.join(", ")}`),Error(`Firebase configuration error: ${a.join(", ")} required`)}if(j.projectId?.includes("demo")||j.projectId?.includes("test")||j.authDomain?.includes("localhost"))throw Error("Development Firebase configuration detected in production!");d=(0,e.Dk)().length?(0,e.Sx)():(0,e.Wp)(j);let k=(0,f.xI)(d),l=(0,g._A)(d,{experimentalForceLongPolling:!1,cacheSizeBytes:0x3200000}),m=(0,h.c7)(d);if("true"===process.env.NEXT_PUBLIC_USE_FIREBASE_EMULATOR){let a=process.env.NEXT_PUBLIC_EMULATOR_HOST||"localhost";k.emulatorConfig||(0,f.Wq)(k,`http://${a}:9099`,{disableWarnings:!0}),l._settings?.host?.includes("localhost")||(0,g.vN)(l,a,8080),m._host?.includes("localhost")||(0,h.nb)(m,a,9199)}let n=(a,b)=>!!a&&!!b&&a===b,o=new Map,p=(a,b=10,c=6e4)=>{let d=Date.now(),e=o.get(a);return!e||d>e.resetTime?(o.set(a,{count:1,resetTime:d+c}),!0):!(e.count>=b)&&(e.count++,!0)},q=(0,i.lS)(d,{backend:new i.C8})},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13469:(a,b,c)=>{"use strict";c.d(b,{y:()=>d.yA});var d=c(6237)},14985:a=>{"use strict";a.exports=require("dns")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:a=>{"use strict";a.exports=require("process")},21820:a=>{"use strict";a.exports=require("os")},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},28689:(a,b,c)=>{Promise.resolve().then(c.bind(c,68511))},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{"use strict";a.exports=require("path")},34631:a=>{"use strict";a.exports=require("tls")},38417:(a,b,c)=>{Promise.resolve().then(c.bind(c,56501))},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},50060:(a,b,c)=>{"use strict";c.d(b,{A:()=>e});var d=c(35893);let e=d.forwardRef(function({title:a,titleId:b,...c},e){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},c),a?d.createElement("title",{id:b},a):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))})},51716:(a,b,c)=>{"use strict";c.d(b,{Qn:()=>e});var d=c(12400);async function e(a,b={}){try{let c={};if("undefined"!=typeof document){let a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");a&&(c["X-CSRF-Token"]=a)}return fetch(a,{...b,headers:{"Content-Type":"application/json","X-Hive-Client":"web-app-v1",...c,...b.headers},credentials:"include"})}catch(b){throw d.v.error("Secure API fetch failed",{component:"secure-auth-utils",url:a},b instanceof Error?b:void 0),b}}},51970:(a,b,c)=>{"use strict";c.d(b,{W:()=>i});var d=c(35893),e=c(20676),f=c(13469);let g={counters:{},collections:{},timeline:[],computed:{},version:0,lastModified:new Date().toISOString()};async function h(a,b,c=3){let d=null;for(let e=0;e<c;e++)try{return await fetch(a,b)}catch(a){d=a instanceof Error?a:Error("Fetch failed"),e<c-1&&await new Promise(a=>setTimeout(a,1e3*(e+1)))}throw d||Error("Fetch failed after retries")}function i(a){let{toolId:b,spaceId:c,placementId:i,deploymentId:j,autoSave:k=!0,autoSaveDelay:l=2e3,enabled:m=!0,enableRealtime:n=!1,onCascade:o,onRealtimeCounterUpdate:p}=a,q=j||(c&&i?`space:${c}_${i}`:null),{counters:r,collections:s,timeline:t,isConnected:u}=function(a,b={}){let{enabled:c=!0,subscriptions:g,onCountersChange:h,onTimelineEvent:i}=b,[j,k]=(0,d.useState)({}),[l,m]=(0,d.useState)({}),[n,o]=(0,d.useState)([]),[p,q]=(0,d.useState)(null),[r,s]=(0,d.useState)(!1),[t,u]=(0,d.useState)(null);(0,d.useRef)(h),(0,d.useRef)(i),(0,d.useRef)(0);let v=(0,d.useCallback)(()=>{if(a)try{let b=(0,e.C3)(f.y),c=`tool_state/${a}`,d=(0,e.KR)(b,c);(0,e.Zy)(d,a=>{if(a.exists()){let b=a.val();k(b.counters||{}),m(b.collections||{}),o(b.timeline||[]),q(b.metadata||null)}},{onlyOnce:!0})}catch(a){console.error("Failed to refresh RTDB state:",a)}},[a]);return{counters:j,collections:l,timeline:n,metadata:p,isConnected:r,error:t,refresh:v}}(n?q:null,{enabled:n&&m,onCountersChange:p}),[v,w]=(0,d.useState)(null),[x,y]=(0,d.useState)({}),[z,A]=(0,d.useState)(g),[B,C]=(0,d.useState)(!1),[D,E]=(0,d.useState)(!1),[F,G]=(0,d.useState)(!1),[H,I]=(0,d.useState)(!0),[J,K]=(0,d.useState)(null),[L,M]=(0,d.useState)(null),N=(0,d.useRef)(null),O=(0,d.useRef)(!0),P=(0,d.useRef)(x);(0,d.useRef)(z);let Q=(0,d.useRef)({}),R=(0,d.useCallback)(async()=>{if(!b||!m){w(null),y({}),I(!0);return}C(!0),M(null);try{let a=q?`/api/tools/${b}/with-state?deploymentId=${encodeURIComponent(q)}`:`/api/tools/${b}`,c=await h(a,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!c.ok){if(404===c.status)throw Error("Tool not found");throw Error(`Failed to load tool: ${c.status}`)}let d=await c.json();if(!O.current)return;let e=d.tool||d,f=(e.elements||[]).map(a=>{let b=a.instanceId??a.id??a.elementId,c=a.elementId??a.id;return{id:a.id,elementId:null!=c?String(c):String(b??""),instanceId:null!=b?String(b):String(c??""),type:a.type,config:a.config||{},position:a.position,size:a.size}});if(w({id:e.id,name:e.name,description:e.description,elements:f,category:e.category,version:e.version,currentVersion:e.currentVersion,status:e.status||"draft",config:e.config,metadata:e.metadata,creatorId:e.creatorId,campusId:e.campusId,isPublished:e.isPublished,createdAt:e.createdAt,updatedAt:e.updatedAt}),void 0!==d.state||void 0!==d.userState){let a=d.userState||d.state||{};y(a),Q.current=a,I(!0)}else q&&(y({}),Q.current={},I(!0));void 0!==d.sharedState?A(d.sharedState):A(g)}catch(a){O.current&&M(a instanceof Error?a:Error("Failed to load tool"))}finally{O.current&&C(!1)}},[b,q,m]),S=(0,d.useCallback)(async()=>{if(q){N.current&&(clearTimeout(N.current),N.current=null),G(!0);try{let a=await h(`/api/tools/state/${encodeURIComponent(q)}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:P.current,toolId:b,spaceId:c})});if(!a.ok)throw Error(`Failed to save state: ${a.status}`);O.current&&(K(new Date),I(!0),Q.current={...P.current})}catch(a){console.error("Failed to save tool state:",a),O.current&&I(!1)}finally{O.current&&G(!1)}}},[q,b,c]),T=(0,d.useCallback)(()=>{k&&q&&(N.current&&clearTimeout(N.current),I(!1),N.current=setTimeout(()=>{S()},l))},[k,q,l,S]),U=(0,d.useCallback)(async(a,d,e)=>{if(!b)return{success:!1,error:"No tool loaded"};E(!0),M(null);try{let f=await h("/api/tools/execute",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({toolId:b,deploymentId:q,elementId:a,action:d,data:e||{},spaceId:c})});if(!f.ok){let a=await f.json().catch(()=>({}));throw Error(a.error||`Action failed: ${f.status}`)}let g=await f.json();if(!O.current)return{success:!0,result:g.result};g.state&&(y(a=>({...a,...g.state})),P.current={...P.current,...g.state},T());let i=g.result?.data?.cascadedElements;return i&&i.length>0&&o&&o(i),{success:!0,result:g.result,state:g.state,cascadedElements:i}}catch(b){console.error("Action execution failed:",b);let a=b instanceof Error?b:Error("Action failed");return O.current&&M(a),{success:!1,error:a.message}}finally{O.current&&E(!1)}},[b,q,c,T,o]),V=(0,d.useCallback)(a=>{y(b=>{let c={...b,...a};return P.current=c,c}),T()},[T]),W=(0,d.useCallback)(a=>{y(a),P.current=a,T()},[T]);return{tool:v,state:x,userState:x,sharedState:z,isLoading:B,isExecuting:D,isSaving:F,isSynced:H,isRealtimeConnected:u,lastSaved:J,error:L,executeAction:U,updateState:V,setState:W,saveState:S,reset:(0,d.useCallback)(()=>{N.current&&(clearTimeout(N.current),N.current=null),y(Q.current),P.current=Q.current,M(null),I(!0)},[]),reload:(0,d.useCallback)(async()=>{await R()},[R])}}},55511:a=>{"use strict";a.exports=require("crypto")},56501:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(41210).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/[spaceId]/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/[spaceId]/page.tsx","default")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68511:(a,b,c)=>{"use strict";let d,e;c.r(b),c.d(b,{default:()=>ae});var f=c(44748),g=c(35893),h=c(89250),i=c(19887),j=c(61892),k=c(2344),l=c(77682),m=c(39406),n=c(99852),o=c(28039),p=c(90285),q=c(6330),r=c(48209),s=c(12464),t=c(21509),u=c(14776),v=c(37622),w=c(67111),x=c(43689),y=c(47817),z=c(81832),A=c(94369),B=c(55748),C=c(29038),D=c(9848),E=c(75718),F=c(32897),G=c(91400),H=c(80765),I=c(95206),J=c(6490),K=c(51449),L=c(74359),M=c(93006),N=c(20676),O=c(13469),P=c(91436);class Q{static{this.TYPING_WRITE_THROTTLE_MS=3e3}constructor(){this.listeners=new Map,this.lastTypingWrite=new Map,this.database=(0,N.C3)(O.y)}async sendMessage(a){try{let b=(0,N.KR)(this.database,`channels/${a.channel}/messages`),c=(0,N.VC)(b),d={...a,id:c.key,metadata:{...a.metadata,timestamp:(0,N.O5)()}};return await (0,N.hZ)(c,d),await (0,N.hZ)((0,N.KR)(this.database,`channels/${a.channel}/lastActivity`),(0,N.O5)()),P.vF.info("Message sent to channel",{messageId:c.key,channel:a.channel,type:a.type}),c.key}catch(b){throw P.vF.error("Error sending message",{error:{error:b instanceof Error?b.message:String(b)},channel:a.channel}),b}}async sendChatMessage(a,b,c,d="text"){try{let e=(0,N.KR)(this.database,`chats/${a}/messages`),f=(0,N.VC)(e),g={id:f.key,spaceId:a,userId:b,content:c,type:d,timestamp:(0,N.O5)()};return await (0,N.hZ)(f,g),await (0,N.hZ)((0,N.KR)(this.database,`chats/${a}/lastMessage`),{id:f.key,userId:b,timestamp:(0,N.O5)(),preview:c.substring(0,100)}),await this.sendMessage({type:"notification",channel:`space:${a}:chat`,senderId:b,content:{type:"new_chat_message",spaceId:a,messageId:f.key,preview:c.substring(0,100)},metadata:{timestamp:(0,N.O5)(),priority:"normal",requiresAck:!1,retryCount:0}}),f.key}catch(c){throw P.vF.error("Error sending chat message",{error:{error:c instanceof Error?c.message:String(c)},spaceId:a,userId:b}),c}}async updatePresence(a,b){try{let c={userId:a,...b,lastSeen:(0,N.O5)()},d=(0,N.KR)(this.database,`presence/${a}`);if(await (0,N.hZ)(d,c),b.currentSpace){let d=(0,N.KR)(this.database,`space_presence/${b.currentSpace}/${a}`);await (0,N.hZ)(d,c),await this.sendMessage({type:"presence",channel:`space:${b.currentSpace}:presence`,senderId:"system",content:{userId:a,status:b.status,activity:b.activity},metadata:{timestamp:(0,N.O5)(),priority:"low",requiresAck:!1,retryCount:0}})}P.vF.info("User presence updated",{userId:a,status:b.status})}catch(b){throw P.vF.error("Error updating presence",{error:{error:b instanceof Error?b.message:String(b)},userId:a}),b}}async clearSpacePresence(a,b){try{let c=(0,N.KR)(this.database,`space_presence/${b}/${a}`);await (0,N.hZ)(c,null),P.vF.info("Space presence cleared",{userId:a,spaceId:b})}catch(c){P.vF.error("Error clearing space presence",{error:c instanceof Error?c.message:String(c),userId:a,spaceId:b})}}async setTypingIndicator(a,b,c){try{let d=(0,N.KR)(this.database,`typing/${a}/${b}`);if(c){let c={userId:b,spaceId:a,timestamp:(0,N.O5)(),isTyping:!0};await (0,N.hZ)(d,c)}else await (0,N.hZ)(d,null);await this.sendMessage({type:"system",channel:`space:${a}:typing`,senderId:b,content:{isTyping:c,userId:b},metadata:{timestamp:(0,N.O5)(),priority:"low",requiresAck:!1,retryCount:0}})}catch(c){throw P.vF.error("Error setting typing indicator",{error:{error:c instanceof Error?c.message:String(c)},spaceId:a,userId:b}),c}}async sendToolUpdate(a,b,c,d){try{await (0,N.hZ)((0,N.KR)(this.database,`tools/${a}/state`),{...d,lastUpdated:(0,N.O5)(),updatedBy:c}),await this.sendMessage({type:"tool_update",channel:`space:${b}:tools`,senderId:c,content:{toolId:a,updateType:d.type||"state_change",data:d},metadata:{timestamp:(0,N.O5)(),priority:"normal",requiresAck:!0,retryCount:0}}),P.vF.info("Tool update sent",{toolId:a,spaceId:b,userId:c})}catch(c){throw P.vF.error("Error sending tool update",{error:{error:c instanceof Error?c.message:String(c)},toolId:a,spaceId:b}),c}}async sendNotification(a,b){try{let c=Array.isArray(a)?a:[a];for(let a of c)await this.sendMessage({type:"notification",channel:`user:${a}:notifications`,senderId:"system",targetUsers:[a],content:b,metadata:{timestamp:(0,N.O5)(),priority:"error"===b.type?"high":"normal",requiresAck:!0,retryCount:0}});P.vF.info("Notification sent",{userIds:c.join(","),type:b.type})}catch(b){throw P.vF.error("Error sending notification",{error:{error:b instanceof Error?b.message:String(b)},userId:Array.isArray(a)?a.join(","):a}),b}}listenToChannel(a,b){let c=(0,N.KR)(this.database,`channels/${a}/messages`),d=(0,N.Zy)(c,a=>{let c=[];a.forEach(a=>{c.push(a.val())}),c.sort((a,b)=>("number"==typeof a.metadata.timestamp?a.metadata.timestamp:0)-("number"==typeof b.metadata.timestamp?b.metadata.timestamp:0)),b(c)});return this.listeners.has(a)||this.listeners.set(a,[]),this.listeners.get(a).push(d),()=>{d();let b=this.listeners.get(a);if(b){let a=b.indexOf(d);a>-1&&b.splice(a,1)}}}listenToChat(a,b){let c=(0,N.KR)(this.database,`chats/${a}/messages`),d=(0,N.Zy)(c,a=>{let c=[];a.forEach(a=>{c.push(a.val())}),c.sort((a,b)=>("number"==typeof a.timestamp?a.timestamp:0)-("number"==typeof b.timestamp?b.timestamp:0)),b(c)}),e=`chat:${a}`;return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(d),()=>{d();let a=this.listeners.get(e);if(a){let b=a.indexOf(d);b>-1&&a.splice(b,1)}}}listenToChatBoard(a,b,c,d){let e=(0,N.KR)(this.database,`chats/${a}/boards/${b}/messages`),f=(0,N.Zy)(e,a=>{let b=[];a.forEach(a=>{let c=a.val();b.push({...c,id:c.id||a.key||""})}),b.sort((a,b)=>("number"==typeof a.timestamp?a.timestamp:0)-("number"==typeof b.timestamp?b.timestamp:0)),c(b)},c=>{P.vF.error("RTDB chat board listener error",{spaceId:a,boardId:b,error:c instanceof Error?c.message:String(c)}),d?.(c)}),g=`chat:${a}:${b}`;return this.listeners.has(g)||this.listeners.set(g,[]),this.listeners.get(g).push(f),P.vF.info("RTDB chat board listener started",{spaceId:a,boardId:b}),()=>{f();let c=this.listeners.get(g);if(c){let a=c.indexOf(f);a>-1&&c.splice(a,1)}P.vF.info("RTDB chat board listener stopped",{spaceId:a,boardId:b})}}listenToBoardTyping(a,b,c){let d=(0,N.KR)(this.database,`typing/${a}/${b}`),e=(0,N.Zy)(d,a=>{let b={};a.forEach(a=>{a.key&&(b[a.key]=a.val())}),c(b)}),f=`typing:${a}:${b}`;return this.listeners.has(f)||this.listeners.set(f,[]),this.listeners.get(f).push(e),()=>{e();let a=this.listeners.get(f);if(a){let b=a.indexOf(e);b>-1&&a.splice(b,1)}}}async setBoardTypingIndicator(a,b,c,d){try{let e=`${a}:${b}:${c}`,f=Date.now(),g=this.lastTypingWrite.get(e);if(g){let a=f-g.time;if(g.isTyping===d&&a<Q.TYPING_WRITE_THROTTLE_MS||!d&&!g.isTyping)return}this.lastTypingWrite.set(e,{time:f,isTyping:d});let h=(0,N.KR)(this.database,`typing/${a}/${b}/${c}`);if(d){let b={userId:c,spaceId:a,timestamp:(0,N.O5)(),isTyping:!0};await (0,N.hZ)(h,b)}else await (0,N.hZ)(h,null)}catch(d){P.vF.error("Error setting board typing indicator",{error:{error:d instanceof Error?d.message:String(d)},spaceId:a,boardId:b,userId:c})}}async cleanupStaleTypingIndicators(a,b,c=1e4){try{let d=(0,N.KR)(this.database,`typing/${a}/${b}`),e=await (0,N.Jt)(d);if(!e.exists())return 0;let f=Date.now(),g=0,h={};return e.forEach(a=>{let b=a.val(),d="number"==typeof b.timestamp?b.timestamp:0;f-d>c&&a.key&&(h[a.key]=null,g++)}),g>0&&(await (0,N.yo)(d,h),P.vF.debug("Cleaned up stale typing indicators",{spaceId:a,boardId:b,cleanedCount:g})),g}catch(c){return P.vF.error("Error cleaning up typing indicators",{error:{error:c instanceof Error?c.message:String(c)},spaceId:a,boardId:b}),0}}listenToPresence(a,b){let c=(0,N.KR)(this.database,`space_presence/${a}`),d=(0,N.Zy)(c,a=>{let c={};a.forEach(a=>{let b=a.val();a.key&&(c[a.key]=b)}),b(c)}),e=`presence:${a}`;return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(d),()=>{d();let a=this.listeners.get(e);if(a){let b=a.indexOf(d);b>-1&&a.splice(b,1)}}}listenToTyping(a,b){let c=(0,N.KR)(this.database,`typing/${a}`),d=(0,N.Zy)(c,a=>{let c={};a.forEach(a=>{a.key&&(c[a.key]=a.val())}),b(c)}),e=`typing:${a}`;return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(d),()=>{d();let a=this.listeners.get(e);if(a){let b=a.indexOf(d);b>-1&&a.splice(b,1)}}}async getMessageHistory(a,b=50){try{let c=(0,N.KR)(this.database,`channels/${a}/messages`);return new Promise((a,d)=>{(0,N.Zy)(c,c=>{let d=[];c.forEach(a=>{d.push(a.val())}),d.sort((a,b)=>{let c="number"==typeof a.metadata.timestamp?a.metadata.timestamp:0;return("number"==typeof b.metadata.timestamp?b.metadata.timestamp:0)-c}),a(d.slice(0,b))},d,{onlyOnce:!0})})}catch(b){throw P.vF.error("Error getting message history",{error:{error:b instanceof Error?b.message:String(b)},channel:a}),b}}async markMessagesAsRead(a,b,c){try{await Promise.all(c.map(async c=>{let d=(0,N.KR)(this.database,`channels/${a}/messages/${c}/delivery/read`);await (0,N.c4)(d,a=>{let c=a||[];if(!c.includes(b))return[...c,b]})}))}catch(c){throw P.vF.error("Error marking messages as read",{error:{error:c instanceof Error?c.message:String(c)},channel:a,userId:b}),c}}cleanup(){this.listeners.forEach((a,b)=>{a.forEach(a=>{try{a()}catch(a){P.vF.error("Error cleaning up listener",{channel:b,error:a instanceof Error?a.message:String(a)})}})}),this.listeners.clear(),P.vF.info("All Firebase realtime listeners cleaned up")}}let R=new Q;var S=c(55511);let T=(a=21)=>{(a=>{!d||d.length<a?(d=Buffer.allocUnsafe(128*a),S.randomFillSync(d),e=0):e+a>d.length&&(S.randomFillSync(d),e=0),e+=a})(a|=0);let b="";for(let c=e-a;c<e;c++)b+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&d[c]];return b};var U=c(12400);let V={isOpen:!1,parentMessage:null,replies:[],isLoading:!1,isLoadingMore:!1,hasMore:!1},W=new Set(["poll","vote","let's vote","voting","rsvp","sign up","registration","attend","countdown","timer","days until","announce"]);function X(a){let b=a.toLowerCase().trim();if(b.startsWith("/")||a.includes("\uD83D\uDCE2"))return!0;for(let a of W)if(b.includes(a))return!0;return!1}var Y=c(51970),Z=c(51716);let $={hasSeenWelcome:!1,completedAt:null,tasks:{deployTool:!1,createEvent:!1,inviteMembers:!1,customizeSidebar:!1},dismissedAt:null};var _=c(61375);function aa({activeDrawer:a,setActiveDrawer:b,space:c,events:d,tools:e,leaders:g,automations:h,isLeader:i,onOpenTemplates:j}){return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"lg:hidden",children:(0,f.jsx)(t.E,{activeDrawer:a,onAction:a=>b(a),isLeader:i})}),(0,f.jsx)(u.m,{type:"info",open:"info"===a,onOpenChange:a=>b(a?"info":null),spaceData:{name:c.name,description:c.description,memberCount:c.memberCount,onlineCount:c.onlineCount,category:c.category}}),(0,f.jsx)(u.m,{type:"events",open:"events"===a,onOpenChange:a=>b(a?"events":null),events:d.map(a=>({id:a.id,title:a.title,date:new Date(a.startDate).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),attendees:a.currentAttendees}))}),(0,f.jsx)(u.m,{type:"tools",open:"tools"===a,onOpenChange:a=>b(a?"tools":null),tools:e.map(a=>({id:a.id,name:a.name,description:a.type}))}),(0,f.jsx)(u.m,{type:"members",open:"members"===a,onOpenChange:a=>b(a?"members":null),members:g.map(a=>({id:a.id,name:a.name,avatarUrl:a.avatarUrl,role:a.role,isOnline:!1}))}),i&&(0,f.jsx)(u.m,{type:"automations",open:"automations"===a,onOpenChange:a=>b(a?"automations":null),automations:h?.map(a=>({id:a.id,name:a.name,trigger:a.trigger,enabled:a.enabled,runCount:a.runCount})),onOpenTemplates:j})]})}function ab({tabs:a,boards:b,activeBoardId:c,addTabModalOpen:d,setAddTabModalOpen:e,addWidgetModalOpen:g,setAddWidgetModalOpen:h,inviteMemberModalOpen:k,setInviteMemberModalOpen:l,createEventModalOpen:m,setCreateEventModalOpen:n,onAddTab:p,onAddWidget:q,onOpenHiveLab:r,onQuickDeploy:t,onInviteMember:u,onSearchUsers:v,onCreateEvent:w,existingMemberIds:x,existingTools:y,isLoadingTools:z,onDeployExistingTool:A}){return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(i.o,{open:d,onOpenChange:e,onSubmit:p,existingTabNames:a.map(a=>a.name)}),(0,f.jsx)(j.j,{open:g,onOpenChange:h,onSubmit:q,onOpenHiveLab:r,onQuickDeploy:t,showQuickDeploy:!!t,showHiveLab:!0,existingTools:y,isLoadingTools:z,onDeployExistingTool:A}),(0,f.jsx)(s.v,{open:k,onOpenChange:l,onSubmit:u,onSearchUsers:v,existingMemberIds:x}),(0,f.jsx)(o.c,{open:m,onOpenChange:n,onSubmit:w,boards:b.map(a=>({id:a.id,name:a.name})),defaultBoardId:c})]})}function ac(){let a=(0,h.useRouter)(),b=(0,h.useSearchParams)(),{user:c}=(0,_.As)(),d="true"!==b.get("legacy"),{space:e,spaceId:i,membership:j,isLoading:o,error:s,joinSpace:t,leaveSpace:u,refresh:D}=(0,M.nW)(),{events:N}=(0,M.Fv)(),{tabs:O}=(0,M.gC)(),{leaderActions:P}=(0,M.rY)(),Q=!!j?.role,S=["owner","admin","leader","moderator"].includes(j?.role||""),{messages:W,boards:ac,activeBoardId:ad,typingUsers:ae,isLoading:af,isLoadingMore:ag,hasMore:ah,error:ai,thread:aj,sendMessage:ak,addReaction:al,pinMessage:am,deleteMessage:an,editMessage:ao,changeBoard:ap,loadMore:aq,setTyping:ar,openThread:as,closeThread:at,sendThreadReply:au,loadMoreReplies:av}=function(a){let{spaceId:b,initialBoardId:c,limit:d=50,enableRealtime:e=!0,enableTypingIndicators:f=!0}=a,[h,i]=(0,g.useState)([]),[j,k]=(0,g.useState)([]),[l,m]=(0,g.useState)(c||"general"),[n,o]=(0,g.useState)([]),[p,q]=(0,g.useState)(!0),[r,s]=(0,g.useState)(!1),[t,u]=(0,g.useState)(!1),[v,w]=(0,g.useState)(null),x=(0,g.useRef)(!0),y=(0,g.useRef)(new Map),z=(0,g.useCallback)(async()=>{if(b)try{let a=await fetch(`/api/spaces/${b}/boards`,{credentials:"include"});if(!a.ok)throw Error(`Failed to fetch boards: ${a.status}`);let d=await a.json();if(x.current&&(k(d.boards||[]),!c&&d.boards?.length>0)){let a=d.boards.find(a=>a.isDefault)||d.boards[0];m(a.id)}}catch(a){console.error("Error fetching boards:",a)}},[b,c]),A=(0,g.useCallback)(async(a,c)=>{if(!b)return;let e=!c;e?q(!0):s(!0),w(null);try{let f=new URLSearchParams({boardId:a,limit:d.toString()});c&&f.set("before",c.toString());let g=await fetch(`/api/spaces/${b}/chat?${f.toString()}`,{credentials:"include"});if(!g.ok)throw Error(`Failed to fetch messages: ${g.status}`);let h=await g.json();x.current&&(e?i(h.messages||[]):i(a=>[...h.messages||[],...a]),u(h.hasMore||!1))}catch(a){console.error("Error fetching messages:",a),x.current&&w(a instanceof Error?a.message:"Failed to fetch messages")}finally{x.current&&(q(!1),s(!1))}},[b,d]),B=(0,g.useCallback)(async a=>{if(b)try{let c=await fetch(`/api/spaces/${b}/chat/pinned?boardId=${a}`,{credentials:"include"});if(!c.ok)return;let d=await c.json();x.current&&o(d.messages||[])}catch(a){console.error("Error fetching pinned messages:",a)}},[b]),C=function(a){let{spaceId:b,boardId:c,messages:d,setMessages:e,setPinnedMessages:f,fetchPinnedMessages:h}=a,i=(0,g.useRef)(new Map),j=(0,g.useCallback)((a,b)=>{i.current.set(a,b)},[]),k=(0,g.useCallback)(a=>i.current.get(a),[]),l=(0,g.useCallback)(a=>{i.current.delete(a)},[]),m=(0,g.useCallback)(a=>{for(let[b,c]of i.current.entries())if(c===a)return b},[]),n=(0,g.useCallback)(async(a,d)=>{if(!b||!a.trim())return;let f=`temp_${T()}`,g={id:f,boardId:c,type:"text",authorId:"current_user",authorName:"You",content:a.trim(),timestamp:Date.now(),reactions:[],replyToId:d};i.current.set(f,null),e(a=>[...a,g]);try{let g=await fetch(`/api/spaces/${b}/chat`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({boardId:c,content:a.trim(),replyToId:d})});if(!g.ok){let a=await g.json().catch(()=>({}));throw Error(a.error||`Failed: ${g.status}`)}let h=await g.json();i.current.set(f,h.messageId),e(a=>a.some(a=>a.id===h.messageId)?(i.current.delete(f),a.filter(a=>a.id!==f)):a.map(a=>a.id===f?{...a,id:h.messageId,timestamp:h.timestamp}:a)),setTimeout(()=>{i.current.delete(f)},5e3)}catch(a){throw U.v.error("Error sending message",{error:a,component:"useChatMutations"}),i.current.delete(f),e(a=>a.filter(a=>a.id!==f)),a}},[b,c,e]),o=(0,g.useCallback)(async(a,c)=>{if(!b||!a||!c.trim())return!1;let f=d.find(b=>b.id===a);if(!f)return!1;e(b=>b.map(b=>b.id===a?{...b,content:c.trim(),editedAt:Date.now()}:b));try{let d=await fetch(`/api/spaces/${b}/chat/${a}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:c.trim()})});if(!d.ok)throw Error(`Failed to edit: ${d.status}`);return!0}catch(b){return U.v.error("Error editing message",{error:b,component:"useChatMutations"}),e(b=>b.map(b=>b.id===a?f:b)),!1}},[b,d,e]),p=(0,g.useCallback)(async a=>{if(b&&a){e(b=>b.map(b=>b.id===a?{...b,isDeleted:!0}:b));try{let c=await fetch(`/api/spaces/${b}/chat/${a}`,{method:"DELETE",credentials:"include"});if(!c.ok)throw Error(`Failed to delete: ${c.status}`)}catch(b){U.v.error("Error deleting message",{error:b,component:"useChatMutations"}),e(b=>b.map(b=>b.id===a?{...b,isDeleted:!1}:b))}}},[b,e]);return{sendMessage:n,editMessage:o,deleteMessage:p,addReaction:(0,g.useCallback)(async(a,f)=>{if(!b||!a||!f)return;let g=d.find(b=>b.id===a);if(g){e(b=>b.map(b=>{if(b.id!==a)return b;let c=b.reactions||[],d=c.find(a=>a.emoji===f);if(d)if(d.hasReacted)return{...b,reactions:c.map(a=>a.emoji===f?{...a,count:Math.max(0,a.count-1),hasReacted:!1}:a).filter(a=>a.count>0)};else return{...b,reactions:c.map(a=>a.emoji===f?{...a,count:a.count+1,hasReacted:!0}:a)};return{...b,reactions:[...c,{emoji:f,count:1,hasReacted:!0}]}}));try{let d=await fetch(`/api/spaces/${b}/chat/${a}/react`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:f,boardId:c})});if(!d.ok)throw Error(`Failed to update reaction: ${d.status}`)}catch(b){U.v.error("Error adding reaction",{error:b,component:"useChatMutations"}),e(b=>b.map(b=>b.id===a?{...g}:b))}}},[b,c,d,e]),pinMessage:(0,g.useCallback)(async a=>{if(!b||!a)return;let g=d.find(b=>b.id===a);if(!g)return;let i=!g.isPinned;e(b=>b.map(b=>b.id===a?{...b,isPinned:i}:b)),i?f(a=>[...a,{...g,isPinned:!0}]):f(b=>b.filter(b=>b.id!==a));try{let d=await fetch(`/api/spaces/${b}/chat/${a}/pin`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({boardId:c})});if(!d.ok)throw Error(`Failed to pin/unpin: ${d.status}`)}catch(b){U.v.error("Error pinning message",{error:b,component:"useChatMutations"}),e(b=>b.map(b=>b.id===a?{...g}:b)),await h(c)}},[b,c,d,e,f,h]),trackInFlightMessage:j,getInFlightRealId:k,clearInFlightMessage:l,findInFlightTempId:m}}({spaceId:b,boardId:l,messages:h,setMessages:i,setPinnedMessages:o,fetchPinnedMessages:B}),D=(0,g.useCallback)(a=>{i(b=>{if(b.some(b=>b.id===a.id))return b;let c=C.findInFlightTempId(a.id);return c?(C.clearInFlightMessage(c),b.map(b=>b.id===c?{...a}:b)):[...b,a]})},[C]),{isConnected:E,disconnect:F}=function(a){let{spaceId:b,boardId:c,enabled:d,onMessage:e,onUpdate:f,onDelete:h}=a,[i,j]=(0,g.useState)(!1),k=(0,g.useRef)(null),l=(0,g.useRef)(null),m=(0,g.useRef)(0),n=(0,g.useRef)(!0),o=(0,g.useRef)(!1),p=(0,g.useRef)(c),q=(0,g.useCallback)(()=>{o.current=!0,k.current&&(k.current.close(),k.current=null),l.current&&(clearTimeout(l.current),l.current=null),j(!1)},[]),r=(0,g.useCallback)(a=>{if(!b||!d)return;o.current=!1,k.current&&(k.current.close(),k.current=null);let c=`/api/spaces/${b}/chat/stream?boardId=${a}`;try{let a=new EventSource(c,{withCredentials:!0});k.current=a,a.onopen=()=>{n.current&&(j(!0),m.current=0)},a.onmessage=a=>{if(n.current)try{let b=JSON.parse(a.data);switch(b.type){case"connected":j(!0);break;case"message":e(b.data);break;case"update":f(b.data);break;case"delete":h(b.data.id)}}catch{}},a.onerror=()=>{if(!n.current)return;if(o.current){j(!1),a.close(),k.current=null;return}j(!1),a.close(),k.current=null;let b=Math.min(1e3*Math.pow(2,m.current),3e4);m.current++,l.current=setTimeout(()=>{n.current&&r(p.current)},b)}}catch(a){console.error("Error creating EventSource:",a),j(!1)}},[b,d,e,f,h]),s=(0,g.useCallback)(()=>{q(),m.current=0,r(p.current)},[q,r]);return{isConnected:i,disconnect:q,reconnect:s}}({spaceId:b,boardId:l,enabled:e,onMessage:D,onUpdate:(0,g.useCallback)(a=>{i(b=>b.map(b=>b.id===a.id?{...b,...a}:b))},[]),onDelete:(0,g.useCallback)(a=>{i(b=>b.map(b=>b.id===a?{...b,isDeleted:!0}:b))},[])}),{typingUsers:G,setTyping:H}=function(a){let{spaceId:b,boardId:c,enabled:d}=a,[e,f]=(0,g.useState)([]),h=(0,g.useRef)(null),i=(0,g.useRef)(0);(0,g.useRef)(null),(0,g.useRef)(!0);let j=(0,g.useRef)(null),k=(0,g.useCallback)(()=>{let a=j.current;b&&c&&a&&(R.setBoardTypingIndicator(b,c,a,!1).catch(()=>{}),h.current&&(clearTimeout(h.current),h.current=null))},[b,c]);return{typingUsers:e,setTyping:(0,g.useCallback)(()=>{if(!b||!c||!d)return;let a=Date.now(),e=a-i.current,f=j.current;if(e>=3e3){if(i.current=a,!f)return void fetch(`/api/spaces/${b}/chat/typing`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({boardId:c})}).catch(()=>{});R.setBoardTypingIndicator(b,c,f,!0).catch(()=>{})}h.current&&clearTimeout(h.current),f&&(h.current=setTimeout(()=>{R.setBoardTypingIndicator(b,c,f,!1).catch(()=>{}),h.current=null},5e3))},[b,c,d]),clearTyping:k}}({spaceId:b,boardId:l,enabled:f}),{thread:I,openThread:J,closeThread:K,sendThreadReply:L,loadMoreReplies:M}=function(a){let{spaceId:b,boardId:c,messages:d,setMessages:e}=a,[f,h]=(0,g.useState)(V),i=(0,g.useRef)(!0),j=(0,g.useCallback)(async a=>{if(!b||!a)return;let c=d.find(b=>b.id===a);if(c){h({isOpen:!0,parentMessage:c,replies:[],isLoading:!0,isLoadingMore:!1,hasMore:!1});try{let d=await fetch(`/api/spaces/${b}/chat/${a}/replies?limit=50`,{credentials:"include"});if(!d.ok)throw Error("Failed to load thread");let e=await d.json();i.current&&h({isOpen:!0,parentMessage:c,replies:e.replies||[],isLoading:!1,isLoadingMore:!1,hasMore:e.hasMore||!1})}catch(a){console.error("Error loading thread:",a),i.current&&h(a=>({...a,isLoading:!1}))}}},[b,d]),k=(0,g.useCallback)(()=>{h(V)},[]),l=(0,g.useCallback)(async a=>{if(!b||!f?.parentMessage?.id||!a.trim())return;let d=`temp-${T()}`,g=Date.now(),j={id:d,boardId:c,type:"text",authorId:"current-user",authorName:"You",content:a.trim(),timestamp:g,replyToId:f.parentMessage.id};h(a=>({...a,replies:[...a.replies,j]}));try{let c=await fetch(`/api/spaces/${b}/chat/${f.parentMessage.id}/replies`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:a.trim()})});if(!c.ok)throw Error("Failed to send reply");let g=await c.json();i.current&&(h(a=>({...a,replies:a.replies.map(a=>a.id===d?g.message:a)})),e(a=>a.map(a=>a.id===f.parentMessage?.id?{...a,threadCount:(a.threadCount||0)+1}:a)))}catch(a){console.error("Error sending thread reply:",a),i.current&&h(a=>({...a,replies:a.replies.filter(a=>a.id!==d)}))}},[b,f?.parentMessage?.id,c,e]),m=(0,g.useCallback)(async()=>{if(!b||!f?.parentMessage?.id||f.isLoadingMore||!f.hasMore)return;let a=f.replies[f.replies.length-1];if(a){h(a=>({...a,isLoadingMore:!0}));try{let c=await fetch(`/api/spaces/${b}/chat/${f.parentMessage.id}/replies?before=${a.id}&limit=50`,{credentials:"include"});if(!c.ok)throw Error("Failed to load more replies");let d=await c.json();i.current&&h(a=>({...a,replies:[...a.replies,...d.replies||[]],isLoadingMore:!1,hasMore:d.hasMore||!1}))}catch(a){console.error("Error loading more replies:",a),i.current&&h(a=>({...a,isLoadingMore:!1}))}}},[b,f?.parentMessage?.id,f?.isLoadingMore,f?.hasMore,f?.replies]);return{thread:f,openThread:j,closeThread:k,sendThreadReply:l,loadMoreReplies:m}}({spaceId:b,boardId:l,messages:h,setMessages:i}),N=(0,g.useCallback)(a=>{y.current.set(l,a)},[l]),O=(0,g.useCallback)(()=>y.current.get(l),[l]),P=(0,g.useCallback)(a=>{a!==l&&(m(a),i([]),u(!1),F())},[l,F]),Q=(0,g.useCallback)(async()=>{if(!t||r||0===h.length)return;let a=h[0];a?.timestamp&&await A(l,a.timestamp)},[t,r,h,l,A]),S=(0,g.useCallback)(async()=>{await z(),await A(l),await B(l)},[z,A,B,l]);return{messages:h,boards:j,activeBoardId:l,typingUsers:G,pinnedMessages:n,thread:I,isLoading:p,isLoadingMore:r,hasMore:t,error:v,isConnected:E,sendMessage:C.sendMessage,editMessage:C.editMessage,deleteMessage:C.deleteMessage,addReaction:C.addReaction,pinMessage:C.pinMessage,changeBoard:P,loadMore:Q,setTyping:H,refresh:S,saveScrollPosition:N,getScrollPosition:O,openThread:J,closeThread:K,sendThreadReply:L,loadMoreReplies:M}}({spaceId:i??"",enableRealtime:!0,pollingIntervalMs:1e3}),[aw,ax]=g.useState([]),[ay,az]=g.useState(!1),[aA,aB]=g.useState([]),[aC,aD]=g.useState(!1),[aE,aF]=g.useState(!1),[aG,aH]=g.useState(!1),[aI,aJ]=g.useState(!1),[aK,aL]=g.useState([]),[aM,aN]=g.useState(!1);g.useEffect(()=>{aE&&S&&(async()=>{aN(!0);try{let a=await (0,Z.Qn)("/api/tools?status=published&limit=10");if(a.ok){let b=await a.json();aL(b.tools||[])}}catch(a){U.v.error("Failed to fetch existing tools",{error:a})}finally{aN(!1)}})()},[aE,S]);let[aO,aP]=g.useState(null),[aQ,aR]=g.useState(!1),[aS,aT]=g.useState(!1),[aU,aV]=g.useState(null),[aW,aX]=g.useState(!1),[aY,aZ]=g.useState(!1),[a$,a_]=g.useState(!1),[a0,a1]=g.useState(null),[a2,a3]=g.useState(null),a4=(0,Y.W)({toolId:aO?.toolId||"",spaceId:i??void 0,placementId:aO?.placementId,autoSave:!0,autoSaveDelay:1500,enableRealtime:!0}),{messages:a5,isLoading:a6}=function(a){let{spaceId:b,boardId:c="general",enabled:d=!0}=a,[e,f]=(0,g.useState)([]),[h,i]=(0,g.useState)(!1),[j,k]=(0,g.useState)(null),l=(0,g.useRef)(!0),m=(0,g.useRef)(new Set),n=(0,g.useRef)(new Set),o=(0,g.useCallback)(async()=>{if(b&&d){i(!0),k(null);try{let a=new URLSearchParams;c&&a.set("boardId",c);let d=await fetch(`/api/spaces/${b}/chat/pinned?${a.toString()}`,{credentials:"include"});if(!d.ok)throw Error(`Failed to fetch pinned messages: ${d.status}`);let e=await d.json();l.current&&f(e.messages||[])}catch(a){console.error("Error fetching pinned messages:",a),l.current&&k(a instanceof Error?a.message:"Failed to fetch pinned messages")}finally{l.current&&i(!1)}}},[b,c,d]);return{messages:e,isLoading:h,error:j,pinMessage:(0,g.useCallback)(async a=>{if(!(!b||!a||m.current.has(a))){m.current.add(a);try{let c=await fetch(`/api/spaces/${b}/chat/${a}/pin`,{method:"POST",credentials:"include"});if(!c.ok)throw Error(`Failed to pin message: ${c.status}`);await o()}catch(a){throw console.error("Error pinning message:",a),a}finally{m.current.delete(a)}}},[b,o]),unpinMessage:(0,g.useCallback)(async a=>{if(!(!b||!a||n.current.has(a))){n.current.add(a),f(b=>b.filter(b=>b.id!==a));try{let c=await fetch(`/api/spaces/${b}/chat/${a}/pin`,{method:"DELETE",credentials:"include"});if(!c.ok)throw Error(`Failed to unpin message: ${c.status}`)}catch(a){throw console.error("Error unpinning message:",a),await o(),a}finally{n.current.delete(a)}}},[b,o]),refresh:o}}({spaceId:i??"",enabled:!!i}),{automations:a7,isLoading:a8,isLeader:a9,toggle:ba,remove:bb,refetch:bc}=function(a){let[b,c]=(0,g.useState)({automations:[],isLoading:!1,error:null,actionError:null,isLeader:!1}),d=(0,g.useRef)(new Set),e=(0,g.useRef)(new Set),f=(0,g.useCallback)(async()=>{if(a){c(a=>({...a,isLoading:!0,error:null}));try{let b=await (0,Z.Qn)(`/api/spaces/${a}/automations`);if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to fetch automations")}let d=await b.json();c(a=>({...a,automations:d.data?.automations||[],isLeader:d.data?.isLeader||!1,isLoading:!1}))}catch(a){c(b=>({...b,error:a instanceof Error?a.message:"Failed to load automations",isLoading:!1}))}}},[a]),h=(0,g.useCallback)(async b=>{if(!a||d.current.has(b))return!1;d.current.add(b),c(a=>({...a,actionError:null})),c(a=>({...a,automations:a.automations.map(a=>a.id===b?{...a,enabled:!a.enabled}:a)}));try{let d=await (0,Z.Qn)(`/api/spaces/${a}/automations/${b}/toggle`,{method:"POST"});if(!d.ok){let a=await d.json().catch(()=>({}));throw Error(a.error||"Failed to toggle automation")}let e=await d.json(),f=e.data?.enabled;return c(a=>({...a,automations:a.automations.map(a=>a.id===b?{...a,enabled:f}:a)})),!0}catch(a){return c(c=>({...c,automations:c.automations.map(a=>a.id===b?{...a,enabled:!a.enabled}:a),actionError:a instanceof Error?a.message:"Failed to toggle automation"})),!1}finally{d.current.delete(b)}},[a]),i=(0,g.useCallback)(async d=>{if(!a||e.current.has(d))return!1;e.current.add(d),c(a=>({...a,actionError:null}));let f=b.automations.find(a=>a.id===d);c(a=>({...a,automations:a.automations.filter(a=>a.id!==d)}));try{let b=await (0,Z.Qn)(`/api/spaces/${a}/automations/${d}`,{method:"DELETE"});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to remove automation")}return!0}catch(a){return f&&c(b=>({...b,automations:[...b.automations,f],actionError:a instanceof Error?a.message:"Failed to remove automation"})),!1}finally{e.current.delete(d)}},[a,b.automations]),j=(0,g.useCallback)(()=>{c(a=>({...a,actionError:null}))},[]);return{...b,refetch:f,toggle:h,remove:i,clearActionError:j}}(i),bd=function(a){let{spaceId:b,isLeader:c,memberCount:d=0,deployedToolCount:e=0,eventCount:f=0}=a,[h,i]=(0,g.useState)($),[j,k]=(0,g.useState)(!1),l=(0,g.useMemo)(()=>[{id:"deployTool",label:"Deploy your first tool",description:"Add a poll, countdown, or custom tool to your sidebar",completed:h.tasks.deployTool,action:"deploy-tool"},{id:"createEvent",label:"Create an event",description:"Schedule your first meeting or event",completed:h.tasks.createEvent,action:"create-event"},{id:"inviteMembers",label:"Invite 5 members",description:"Share your space link with your community",completed:h.tasks.inviteMembers,action:"invite-members"},{id:"customizeSidebar",label:"Customize your sidebar",description:"Arrange widgets and add quick links",completed:h.tasks.customizeSidebar,action:"customize-sidebar"}],[h.tasks]),m=l.filter(a=>a.completed).length,n=l.length,o=Math.round(m/n*100),p=(0,g.useMemo)(()=>!!c&&!!b&&!!j&&!h.hasSeenWelcome&&!h.dismissedAt,[c,b,j,h.hasSeenWelcome,h.dismissedAt]),q=(0,g.useMemo)(()=>!!c&&!!b&&!!j&&!(m>=n)&&!h.completedAt&&(h.hasSeenWelcome||null!==h.dismissedAt),[c,b,j,m,n,h]),r=(0,g.useCallback)(()=>{if(!b)return;let a={...h,hasSeenWelcome:!0};i(a)},[b,h]),s=(0,g.useCallback)(a=>{if(!b)return;let c={...h.tasks,[a]:!0},d=Object.values(c).every(Boolean),e={...h,tasks:c,completedAt:d?Date.now():null};i(e)},[b,h]),t=(0,g.useCallback)(()=>{if(!b)return;let a={...h,dismissedAt:Date.now()};i(a)},[b,h]);return{shouldShowOnboarding:p,shouldShowProgress:q,state:h,tasks:l,completedCount:m,totalCount:n,percentComplete:o,markWelcomeSeen:r,markTaskComplete:s,dismiss:t,reset:(0,g.useCallback)(()=>{b&&i($)},[b])}}({spaceId:i??"",isLeader:S,deployedToolCount:aw.length,eventCount:N.length,memberCount:e?.memberCount??0}),be=function(a){let{isLeader:b,isEnabled:c,leaderOnboarding:d,participantCount:e=0}=a,f=b&&c,h=d.percentComplete>=100;return{shouldShowRitual:(0,g.useMemo)(()=>!!f&&!h&&(d.state.hasSeenWelcome||d.completedCount>0),[f,h,d.state.hasSeenWelcome,d.completedCount]),ritualData:(0,g.useMemo)(()=>f?{id:"founding-class-2026",name:"Founding Leader Class of 2026",description:"Complete your space setup to earn permanent Founding Leader status",icon:"\uD83C\uDFC6",progress:d.percentComplete,participantCount:e,timeRemaining:function(){let a=new Date("2026-01-31T23:59:59"),b=new Date;if(b>a)return;let c=a.getTime()-b.getTime(),d=Math.floor(c/864e5),e=Math.floor(c%864e5/36e5);return d>0?`${d}d ${e}h`:`${e}h`}(),isParticipating:!0}:null,[f,d.percentComplete,e]),isEligible:f,isComplete:h}}({isLeader:S,isEnabled:!0,leaderOnboarding:bd,participantCount:23}),bf=(0,H.e5)(i??""),[bg,bh]=g.useState(!1);g.useEffect(()=>{if(Q&&!S&&bf.shouldShow&&!bf.isLoading){let a=setTimeout(()=>bh(!0),800);return()=>clearTimeout(a)}},[Q,S,bf.shouldShow,bf.isLoading]);let[bi,bj]=g.useState(null);g.useEffect(()=>{if(i&&!o){if(S||Q)return void bj(!1);bj(!JSON.parse(localStorage.getItem("hive_visited_spaces")||"[]").includes(i))}},[i,o,S,Q]);let bk=g.useCallback(()=>{if(!i)return;let a="hive_visited_spaces",b=JSON.parse(localStorage.getItem(a)||"[]");b.includes(i)||(b.push(i),localStorage.setItem(a,JSON.stringify(b))),bj(!1)},[i]),{checkIntent:bl,createComponent:bm,isLoading:bn}=function(a){let[b,c]=(0,g.useState)(!1),[d,e]=(0,g.useState)(null),f=(0,g.useRef)(null),h=(0,g.useRef)(null),i=(0,g.useCallback)(async(b,d)=>{if(!a||!d||!b.trim()||!X(b))return{hasIntent:!1,intentType:"none"};f.current?.abort();let g=new AbortController;f.current=g,c(!0),e(null);try{let c=await fetch(`/api/spaces/${a}/chat/intent`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",signal:g.signal,body:JSON.stringify({message:b,boardId:d,createIfDetected:!1})});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a.error||`Intent check failed: ${c.status}`)}return await c.json()}catch(b){if(b instanceof Error&&"AbortError"===b.name)return{hasIntent:!1,intentType:"none"};let a=b instanceof Error?b.message:"Intent check failed";return e(a),{hasIntent:!1,intentType:"none",error:a}}finally{f.current===g&&(c(!1),f.current=null)}},[a]),j=(0,g.useCallback)(async(b,d,f)=>{if(!a||!d||!b.trim())return{success:!1,error:"Missing required parameters"};h.current?.abort();let g=new AbortController;h.current=g,c(!0),e(null);try{let c=await fetch(`/api/spaces/${a}/chat/intent`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",signal:g.signal,body:JSON.stringify({message:b,boardId:d,messageId:f,createIfDetected:!0})});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a.error||`Component creation failed: ${c.status}`)}let e=await c.json();if(e.created&&e.component)return{success:!0,created:!0,component:e.component,description:e.description};return{success:!1,error:e.confirmationMessage||e.error||"Component not created"}}catch(b){if(b instanceof Error&&"AbortError"===b.name)return{success:!1,error:"Request cancelled"};let a=b instanceof Error?b.message:"Component creation failed";return e(a),{success:!1,error:a}}finally{h.current===g&&(c(!1),h.current=null)}},[a]),k=(0,g.useCallback)(async(a,b)=>i(a,b),[i]);return{checkIntent:i,createComponent:j,previewComponent:k,isLoading:b,error:d,clearError:(0,g.useCallback)(()=>{e(null)},[])}}(i??""),[bo,bp]=g.useState(null);g.useEffect(()=>{(async()=>{if(i&&Q)try{let a=await (0,Z.Qn)(`/api/spaces/${i}/tools`);if(!a.ok)return;let b=await a.json(),c=Array.isArray(b.tools)?b.tools:[];ax(c.map(a=>({id:a.placementId||a.toolId,toolId:a.toolId,placementId:a.placementId,name:a.titleOverride||a.name,type:a.category||"tool",isActive:!0===a.isActive,responseCount:a.usageCount||0}))),az(!!b.hasMore)}catch{}})()},[i,Q]),g.useEffect(()=>{(async()=>{if(i&&Q)try{let a=await (0,Z.Qn)(`/api/spaces/${i}/members?role=owner&limit=5`),b=await (0,Z.Qn)(`/api/spaces/${i}/members?role=admin&limit=5`),d=a.ok?await a.json():{members:[]},e=b.ok?await b.json():{members:[]},f=Array.isArray(d.members)?d.members:[],g=Array.isArray(e.members)?e.members:[],h=[...f,...g].map(a=>({id:a.id,name:a.name,avatarUrl:a.avatar,role:a.role}));c&&j?.role==="owner"?h.some(a=>a.id===c.uid)||h.unshift({id:c.uid,name:c.displayName||"You",avatarUrl:c.photoURL||void 0,role:"owner"}):c&&j&&["leader","admin","moderator"].includes(j.role||"")&&(h.some(a=>a.id===c.uid)||h.unshift({id:c.uid,name:c.displayName||"You",avatarUrl:c.photoURL||void 0,role:"leader"})),aB(h)}catch{}})()},[i,Q,j,c]);let bq=g.useCallback(async a=>{if(!P)throw Error("Not authorized");if(!await P.addTab({name:a.name,type:a.type}))throw Error("Failed to create tab")},[P]),br=g.useCallback(async a=>{if(!P)throw Error("Not authorized");if(!await P.addWidget({type:a.type,title:a.title,config:a.config}))throw Error("Failed to create widget")},[P]),bs=g.useCallback(()=>{i&&a.push(`/tools/create?spaceId=${i}`)},[a,i]),bt=g.useCallback(async a=>{if(!i)throw Error("Space not found");let b=await (0,Z.Qn)("/api/tools/deploy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toolId:a,deployTo:"space",targetId:i})});if(!b.ok)throw Error((await b.json().catch(()=>({}))).error||"Failed to deploy tool");D(),L.oR.success("Tool deployed","Tool has been added to the sidebar.")},[i,D]),bu=g.useCallback(async a=>{if(!i)throw Error("Space not found");let b=await (0,Z.Qn)(`/api/spaces/${i}/members`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.userId,role:a.role})});if(!b.ok)throw Error((await b.json().catch(()=>({}))).error||"Failed to invite member");D()},[i,D]),bv=g.useCallback(async a=>{if(!a||a.length<2)return[];try{let b=await (0,Z.Qn)(`/api/search?q=${encodeURIComponent(a)}&type=users&limit=10`);if(!b.ok)return[];return((await b.json()).users||[]).map(a=>({id:a.id,name:a.displayName||a.name||"Unknown",handle:a.handle||a.id,email:a.email,avatarUrl:a.photoURL||a.avatarUrl||void 0}))}catch{return[]}},[]),bw=g.useCallback(async a=>{if(!i)throw Error("Space not found");let b=await (0,Z.Qn)(`/api/spaces/${i}/events`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:a.title,description:a.description,type:a.type,startDate:a.startDate,endDate:a.endDate,location:a.location,virtualLink:a.virtualLink,maxAttendees:a.maxAttendees,requiresRSVP:a.requiredRSVP,announceToSpace:a.announceToSpace,linkedBoardId:a.linkedBoardId})});if(!b.ok)throw Error((await b.json().catch(()=>({}))).error||"Failed to create event");D()},[i,D]),bx=g.useCallback(async(a,b)=>{if(!i)throw Error("Space not found");let c=await (0,Z.Qn)(`/api/spaces/${i}/events/${a}/rsvp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:b})});if(!c.ok)throw Error((await c.json().catch(()=>({}))).error||"Failed to update RSVP");D(),L.oR.success("RSVP updated","going"===b?"You're going!":"maybe"===b?"Marked as maybe":"RSVP removed")},[i,D]),by=g.useCallback(a=>{aV(a),aX(!0)},[]),bz=g.useMemo(()=>{if(!aU)return null;let a=N.find(a=>a.id===aU);if(!a)return null;let b=["academic","social","recreational","cultural","meeting","virtual"].includes(a.type)?a.type:"meeting";return{id:a.id,title:a.title,description:a.description,type:b,startDate:a.startDate,endDate:a.endDate,location:a.location,virtualLink:a.virtualLink,currentAttendees:a.currentAttendees||0,maxAttendees:a.maxAttendees,organizer:a.organizerId?{id:a.organizerId,fullName:a.organizerName||"Organizer",photoURL:a.organizerAvatarUrl}:void 0,userRSVP:a.userRSVP||null,linkedBoardId:a.linkedBoardId}},[aU,N]),bA=g.useCallback(async a=>{if(!i)throw Error("Space not found");let b=await (0,Z.Qn)("/api/tools",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.name,description:a.description,composition:a.composition,status:"published"})});if(!b.ok)throw Error((await b.json().catch(()=>({}))).error||"Failed to create tool");let{tool:c}=await b.json(),d=await (0,Z.Qn)(`/api/spaces/${i}/tools`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toolId:c.id,titleOverride:a.name,position:"sidebar"})});if(!d.ok)throw Error((await d.json().catch(()=>({}))).error||"Failed to deploy tool");let e=await (0,Z.Qn)(`/api/spaces/${i}/tools`);if(e.ok){let a=await e.json();ax((Array.isArray(a.tools)?a.tools:[]).map(a=>({id:a.placementId||a.toolId,toolId:a.toolId,placementId:a.placementId,name:a.titleOverride||a.name,type:a.category||"tool",isActive:!0===a.isActive,responseCount:a.usageCount||0})))}bd.markTaskComplete("deployTool"),L.oR.success(`${a.name} deployed!`,"Your tool is now live in the sidebar.")},[i,bd]),bB=g.useCallback(async a=>{if(!i)return;let b=aw.find(b=>b.id===a||b.toolId===a);if(!b?.placementId)return void L.oR.error("Tool not found","Unable to remove this tool.");try{let a=await (0,Z.Qn)(`/api/spaces/${i}/tools`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({placementId:b.placementId})});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Failed to remove tool")}ax(a=>a.filter(a=>a.placementId!==b.placementId)),L.oR.success("Tool removed",`${b.name} has been removed from the sidebar.`)}catch(b){U.v.error("Failed to remove tool",{toolId:a,error:b}),L.oR.error("Failed to remove tool",b instanceof Error?b.message:"Please try again.")}},[i,aw]),bC=g.useCallback(async(a,b)=>{if(b)return void await ak(a,b);if(S&&ad&&X(a))try{let b=await bl(a,ad);if(b.hasIntent&&"none"!==b.intentType&&"help"!==b.intentType)return void bp({intent:b,message:a,boardId:ad})}catch(a){console.warn("[Space] Intent check failed:",a)}await ak(a,b)},[ak,bl,S,ad]),bD=g.useCallback(async()=>{if(bo)try{let a=await bm(bo.message,bo.boardId);if(a.success&&a.created){bp(null);let a={poll:"Poll",rsvp:"RSVP",countdown:"Countdown",announcement:"Announcement"}[bo.intent.intentType]||"Component";L.oR.success(`${a} created`,"Your interactive component is now live in the chat.")}else console.warn("[Space] Intent component not created:",a.error),L.oR.error("Could not create component",a.error||"Please try again or send as a regular message.")}catch(a){console.error("[Space] Failed to create intent component:",a),L.oR.error("Failed to create component","An unexpected error occurred. Please try again.")}},[bo,bm]),bE=g.useCallback(async()=>{bo&&(await ak(bo.message),bp(null))},[bo,ak]),bF=g.useCallback(()=>{aD(!0)},[]),bG=g.useCallback(async a=>{if(i&&ad)try{let b="event"===a.type?"rsvp":a.type,c={};"poll"===b?(c.question=a.config.question,c.options=a.config.options,c.allowMultiple=a.config.allowMultiple??!1,c.showResults=a.config.showResults??"after_vote"):"countdown"===b?(c.title=a.config.title,c.targetDate=a.config.targetDate):"rsvp"===b&&(c.eventTitle=a.config.eventTitle||a.config.title,c.eventDate=a.config.eventDate||a.config.targetDate,c.allowMaybe=a.config.allowMaybe??!0);let d=await (0,Z.Qn)(`/api/spaces/${i}/components`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({boardId:ad,type:b,content:"",config:c})});if(!d.ok){let a=await d.json().catch(()=>({}));throw Error(a.error||"Failed to create component")}L.oR.success(`${{poll:"Poll",rsvp:"RSVP",countdown:"Countdown",custom:"Component"}[b]||"Tool"} added`,"Your interactive component is now live in the chat.")}catch(a){console.error("[Space] Failed to insert tool:",a),L.oR.error("Failed to add tool",a instanceof Error?a.message:"Please try again.")}},[i,ad]),bH=g.useCallback(async a=>{if(i&&ad){if(["welcome","remind","automate"].includes(a.command))return bI(a);try{let b,c={};switch(a.command){case"poll":b="poll",c.question=a.primaryArg||"Quick Poll",c.options=a.listArgs.length>0?a.listArgs:["Yes","No"],c.allowMultiple=!0===a.flags.multi||!0===a.flags.multiple,c.showResults=a.flags.results||"after_vote";break;case"timer":case"countdown":{b="countdown",c.title=a.primaryArg||"Timer";let d=a.listArgs[0]||a.flags.duration||"5m",e=function(a){let b=a.match(/^(\d+)\s*(s|m|h|d)?$/i);if(!b)return 3e5;let c=parseInt(b[1],10);switch((b[2]||"m").toLowerCase()){case"s":return 1e3*c;case"m":default:return 60*c*1e3;case"h":return 60*c*6e4;case"d":return 24*c*36e5}}(d);c.targetDate=new Date(Date.now()+e).toISOString();break}case"rsvp":case"event":{b="rsvp",c.eventTitle=a.primaryArg||"Event";let d=a.flags.date||a.flags.when;c.eventDate=d?new Date(d).toISOString():new Date(Date.now()+864e5).toISOString(),c.allowMaybe=!1!==a.flags.maybe;break}case"announce":case"announcement":b="custom",c.elementType="announcement",c.settings={message:a.primaryArg||a.raw.replace(/^\/\w+\s*/,""),style:a.flags.style||"info"};break;default:U.v.warn(`[Space] Unknown slash command: ${a.command}`);return}let d=await (0,Z.Qn)(`/api/spaces/${i}/components`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({boardId:ad,type:b,content:"",config:c})});if(!d.ok){let a=await d.json().catch(()=>({}));throw Error(a.error||"Failed to create component")}L.oR.success(`${{poll:"Poll",rsvp:"RSVP",countdown:"Countdown",custom:"Component"}[b]||"Component"} created`,"Your interactive component is now live.")}catch(a){U.v.error("[Space] Failed to execute slash command",a),L.oR.error("Command failed",a instanceof Error?a.message:"Failed to create component")}}},[i,ad]),bI=g.useCallback(async a=>{if(i)try{let b;switch(a.command){case"welcome":{let c=a.primaryArg||"Welcome to our space! \uD83D\uDC4B",d=a.flags.delay?1e3*Number(a.flags.delay):0,e=a.flags.board||ad||"general";b={name:"Welcome Message",description:`Auto-greet new members: "${c.slice(0,50)}${c.length>50?"...":""}"`,trigger:{type:"member_join",config:{delayMs:d}},action:{type:"send_message",config:{boardId:e,content:c}},creationSource:"slash_command",creationPrompt:a.raw};break}case"remind":{let c=parseInt(a.primaryArg||"30",10),d=a.listArgs[0]||` Reminder: {event.title} starts in ${c} minutes!`,e=a.flags.board||ad||"general";b={name:`Event Reminder (${c} min)`,description:`Remind members ${c} minutes before events`,trigger:{type:"event_reminder",config:{beforeMinutes:c}},action:{type:"send_message",config:{boardId:e,content:d}},creationSource:"slash_command",creationPrompt:a.raw};break}case"automate":{let c=a.primaryArg?.toLowerCase()||"welcome",d=a.listArgs[0]||`Custom ${c} automation`;if("welcome"===c)b={name:d,trigger:{type:"member_join",config:{}},action:{type:"send_message",config:{boardId:ad||"general",content:"Welcome to our space!"}},creationSource:"slash_command",creationPrompt:a.raw};else{if("reminder"!==c)return void L.oR.error("Unknown automation type",`Type "${c}" is not supported yet.`);let e=Number(a.flags.before)||30;b={name:d,trigger:{type:"event_reminder",config:{beforeMinutes:e}},action:{type:"send_message",config:{boardId:ad||"general",content:` {event.title} starts in ${e} minutes!`}},creationSource:"slash_command",creationPrompt:a.raw}}break}default:return}let c=await (0,Z.Qn)(`/api/spaces/${i}/automations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a.error||"Failed to create automation")}let d=await c.json(),e={member_join:"when new members join",event_reminder:"before events start",schedule:"on schedule",keyword:"when keywords are detected"}[b.trigger.type]||"";L.oR.success(`${b.name} active!`,`Will automatically run ${e}.`),U.v.info("[Space] Automation created",{result:d})}catch(a){U.v.error("[Space] Failed to create automation",a),L.oR.error("Automation failed",a instanceof Error?a.message:"Failed to create automation")}},[i,ad]);if(o||!e)return(0,f.jsx)("div",{className:"min-h-screen bg-[#0A0A0A]",children:(0,f.jsx)("div",{className:"mx-auto max-w-7xl px-4 py-6",children:(0,f.jsx)(K.Q,{})})});if(null===bi)return(0,f.jsx)("div",{className:"min-h-screen bg-[#050505] flex items-center justify-center",children:(0,f.jsx)("div",{className:"w-4 h-4 border border-white/20 border-t-white/60 rounded-full animate-spin"})});if(bi)return(0,f.jsx)(G.G,{space:{id:i??"",name:e.name,description:e.description,iconUrl:e.iconUrl,bannerUrl:e.bannerUrl,category:e.category,memberCount:e.memberCount,onlineCount:e.onlineCount},events:N.slice(0,3).map(a=>({id:a.id,title:a.title,date:a.startDate})),toolCount:aw.length,onEnter:bk});let bJ="owner"===j.role?"owner":"admin"===j.role?"admin":Q?"joined":"not_joined",bK={spaceId:i??"",about:{spaceId:i??"",description:e.description||"Leaders have not added a description yet.",memberCount:e.memberCount,leaders:aA,isPublic:"public"===e.visibility,isMember:Q},...aw.length>0&&{tools:{spaceId:i??"",tools:aw,hasMore:ay}},...N.length>0&&{upcomingEvents:N.slice(0,3).map(a=>({id:a.id,title:a.title,subtitle:a.type,when:new Date(a.startDate).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),where:a.location||(a.virtualLink?"Online":void 0),isUrgent:new Date(a.startDate).getTime()-Date.now()<864e5}))},...S&&bd.shouldShowProgress&&{setupProgress:{tasks:bd.tasks.map(a=>({id:a.id,label:a.label,description:a.description,completed:a.completed,action:a.action})),completedCount:bd.completedCount,totalCount:bd.totalCount,percentComplete:bd.percentComplete}}},bL=g.useMemo(()=>ac.map(a=>({id:a.id,name:a.name,type:a.type,description:a.description,messageCount:a.messageCount,isDefault:a.isDefault,isLocked:a.isLocked})),[ac]),bM=g.useMemo(()=>ac.map(a=>({id:a.id,name:a.name,type:"general"===a.type?"general":"event"===a.type?"events":"discussion",isDefault:a.isDefault})),[ac]),bN=g.useMemo(()=>W.map(a=>({id:a.id,content:a.content,author:{id:a.authorId,name:a.authorName,avatarUrl:a.authorAvatarUrl,role:a.authorRole},timestamp:new Date(a.timestamp),isEdited:!!a.editedAt,isDeleted:a.isDeleted,isPinned:a.isPinned,reactions:a.reactions,threadCount:a.threadCount})),[W]);return d?(0,f.jsxs)("div",{className:"min-h-screen h-screen bg-[#0A0A0A] flex flex-col overflow-hidden",children:[(0,f.jsx)(x.z,{space:{id:i??"",name:e.name,description:e.description,iconUrl:e.iconUrl,category:e.category,isVerified:e.isVerified,memberCount:e.memberCount,onlineCount:e.onlineCount},membershipState:"owner"===bJ?"owner":"admin"===bJ?"admin":"joined"===bJ?"joined":"not_joined",isLeader:S,currentBoardName:ac.find(a=>a.id===ad)?.name,onJoin:async()=>{await t()},onLeave:async()=>{await u()},onShare:()=>{navigator.clipboard.writeText(window.location.href),L.oR.success("Link copied","Space URL copied to clipboard")},onSettings:S?()=>a.push(`/spaces/${i}/settings`):void 0,onInfo:()=>aZ(!0)}),(0,f.jsx)("div",{className:"flex-1 flex overflow-hidden",children:(0,f.jsx)("main",{className:"flex-1 min-w-0 flex flex-col bg-[#050505]",children:(0,f.jsx)(w.M,{spaceId:i??"",boards:bM,activeBoardId:ad??ac[0]?.id??"general",messages:bN,currentUserId:c?.uid??"anonymous",currentUserName:c?.displayName||"You",currentUserAvatar:c?.photoURL||void 0,typingUsers:ae,isLoading:af,isLoadingMore:ag,hasMoreMessages:ah,canPost:Q,isLeader:S,canEditOwn:!0,canDeleteOwn:!0,canPin:S,scrollToMessageId:a2??void 0,onScrollToMessageComplete:()=>a3(null),onBoardChange:ap,onSendMessage:bC,onLoadMore:aq,onReact:al,onEdit:a=>{U.v.info("[Premium] Edit message",{messageId:a})},onDelete:an,onPin:S?am:void 0,onViewThread:as,onAddBoard:S?bF:void 0,composerPlaceholder:`Message ${ac.find(a=>a.id===ad)?.name||"this space"}...`})})}),(0,f.jsx)(n.S,{isOpen:aY,onClose:()=>aZ(!1),space:{id:i??"",name:e.name,description:e.description,iconUrl:e.iconUrl,category:e.category,memberCount:e.memberCount,onlineCount:e.onlineCount},events:N.slice(0,5).map(a=>({id:a.id,title:a.title,date:new Date(a.startDate),attendees:a.currentAttendees,isUrgent:new Date(a.startDate).getTime()-Date.now()<864e5})),members:aA.map(a=>({id:a.id,name:a.name,avatarUrl:a.avatarUrl,role:"owner"===a.role?"owner":"admin"===a.role?"admin":"member",isOnline:!1})),totalMemberCount:e.memberCount,tools:aw.map(a=>({id:a.id,name:a.name,icon:void 0,isActive:a.isActive})),onViewAllEvents:()=>a.push(`/spaces/${i}/events`),onViewAllMembers:()=>a.push(`/spaces/${i}/members`),onToolClick:a=>{let b=aw.find(b=>b.id===a||b.toolId===a);b&&(aP({id:b.id,toolId:b.toolId,placementId:b.placementId,name:b.name,type:b.type}),aR(!0),aZ(!1))},onEventClick:a=>{by(a),aZ(!1)}}),(0,f.jsx)(aa,{activeDrawer:a0,setActiveDrawer:a1,space:{name:e.name,description:e.description,memberCount:e.memberCount,onlineCount:e.onlineCount??0,category:e.category},events:N,tools:aw,leaders:aA,automations:a7.map(a=>({id:a.id,name:a.name,trigger:a.trigger.type,enabled:a.enabled,runCount:a.stats?.timesTriggered})),isLeader:S,onOpenTemplates:()=>aT(!0)}),P&&(0,f.jsx)(ab,{tabs:O,boards:ac,activeBoardId:ad??void 0,addTabModalOpen:aC,setAddTabModalOpen:aD,addWidgetModalOpen:aE,setAddWidgetModalOpen:aF,inviteMemberModalOpen:aG,setInviteMemberModalOpen:aH,createEventModalOpen:aI,setCreateEventModalOpen:aJ,onAddTab:bq,onAddWidget:br,onOpenHiveLab:bs,onQuickDeploy:bA,onInviteMember:bu,onSearchUsers:bv,onCreateEvent:bw,existingMemberIds:aA.map(a=>a.id),existingTools:aK,isLoadingTools:aM,onDeployExistingTool:bt}),aO&&(0,f.jsx)(J.a,{open:aQ,onOpenChange:a=>{aR(a),a||aP(null)},toolId:aO.toolId,spaceId:i??"",placementId:aO.placementId,toolName:aO.name,onExpandToFullPage:()=>{let b=aO.placementId&&i?`space:${i}_${aO.placementId}`:void 0,c=b?`/tools/${aO.toolId}/run?spaceId=${i}&deploymentId=${encodeURIComponent(b)}`:`/tools/${aO.toolId}/run?spaceId=${i}`;a.push(c),aR(!1),aP(null)},runtime:aO.toolId&&a4.tool?{tool:{...a4.tool,status:a4.tool.status||"draft"},state:a4.state,sharedState:a4.sharedState,userState:a4.userState,isLoading:a4.isLoading,isExecuting:a4.isExecuting,isSaving:a4.isSaving,isSynced:a4.isSynced,lastSaved:a4.lastSaved,error:a4.error instanceof Error?a4.error.message:a4.error,executeAction:async(a,b,c)=>{let d=await a4.executeAction(b||"",a,c);return{success:d.success,data:d.state,error:d.error}},updateState:(a,b)=>{a4.updateState({[a]:b})}}:void 0}),(0,f.jsx)(I.s,{open:aj.isOpen,onOpenChange:a=>{a||at()},parentMessage:aj.parentMessage,replies:aj.replies,isLoading:aj.isLoading,isLoadingMore:aj.isLoadingMore,hasMoreReplies:aj.hasMore,currentUserId:c?.uid??"anonymous",onLoadMore:av,onSendReply:async a=>{await au(a)}}),(0,f.jsx)(p.I,{event:bz,open:aW,onOpenChange:a=>{aX(a),a||aV(null)},onRSVP:bx,onViewBoard:bz?.linkedBoardId?a=>{ap(a),aX(!1),aV(null)}:void 0,currentUserId:c?.uid,spaceId:i??""})]}):(0,f.jsxs)("div",{className:"min-h-screen h-screen bg-[#0A0A0A] flex flex-col overflow-hidden",children:[(0,f.jsx)(C.$,{space:{id:i??"",name:e.name,description:e.description,iconUrl:e.iconUrl,bannerUrl:e.bannerUrl,category:e.category,isVerified:e.isVerified,memberCount:e.memberCount,onlineCount:e.onlineCount},membershipState:bJ,isLeader:S,showTabs:!1,breadcrumb:{campusName:"Spaces",boardName:ac.find(a=>a.id===ad)?.name,boardId:ad,onNavigate:b=>{"campus"===b&&a.push("/spaces/browse")}},onJoin:async()=>{await t()},onLeave:async()=>{await u()},onShare:()=>{navigator.clipboard.writeText(window.location.href)},onSettings:S?()=>a.push(`/spaces/${i}/settings`):void 0,onAnalytics:S?()=>a.push(`/spaces/${i}/analytics`):void 0}),(0,f.jsx)(m.j,{boards:bL,activeBoardId:ad??ac[0]?.id??"general",isLeader:S,onBoardChange:ap,onCreateBoard:S?bF:void 0}),(0,f.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,f.jsxs)("main",{className:"flex-1 lg:flex-[3] min-w-0 flex flex-col bg-[#0A0A0A] relative",children:[bo&&(0,f.jsx)("div",{className:"absolute bottom-24 left-4 right-4 z-50 max-w-3xl mx-auto",children:(0,f.jsx)(q.vw,{intent:bo.intent,onConfirm:bD,onDismiss:bE,isCreating:bn})}),(0,f.jsx)(B.V,{spaceId:i??"",spaceName:e.name,boards:ac,activeBoardId:ad??ac[0]?.id??"general",messages:W,typingUsers:ae,onlineCount:e.onlineCount,isLoading:af,isLoadingMore:ag,hasMoreMessages:ah,currentUserId:c?.uid??"anonymous",currentUserName:c?.displayName||"You",currentUserAvatar:c?.photoURL||void 0,currentUserRole:"owner"===j.role?"owner":"admin"===j.role?"admin":"member",canPost:Q,isLeader:S,scrollToMessageId:a2??void 0,onScrollToMessageComplete:()=>a3(null),onBoardChange:ap,onSendMessage:bC,onLoadMore:aq,onReact:al,onPinMessage:S?am:void 0,onDeleteMessage:an,onEditMessage:ao,onViewThread:as,onCreateBoard:S?bF:void 0,onInsertTool:Q?bG:void 0,onSlashCommand:Q?bH:void 0,showToolbar:Q,enableSlashCommands:Q,onTyping:ar,useEdgeToEdge:!0})]}),(0,f.jsxs)("aside",{className:"hidden lg:flex lg:flex-col lg:flex-[2] max-w-[400px] border-l border-[#2A2A2A] bg-[#0A0A0A]/50 overflow-y-auto lg:sticky lg:top-0 lg:h-screen",children:[(a5.length>0||a6)&&(0,f.jsx)("div",{className:"p-4 border-b border-[#2A2A2A]",children:(0,f.jsx)(v.X,{messages:a5,isLoading:a6,onMessageClick:(a,b)=>{b!==ad&&ap(b),a3(a)},collapsible:!0,defaultCollapsed:!1})}),bd.shouldShowProgress&&(0,f.jsx)("div",{className:"p-4 border-b border-[#2A2A2A]",children:(0,f.jsx)(r.e,{spaceId:i??"",tasks:bd.tasks.map(a=>({id:a.id,label:a.label,description:a.description,completed:a.completed,action:a.action})),completedCount:bd.completedCount,totalCount:bd.totalCount,percentComplete:bd.percentComplete,onTaskAction:a=>{"deploy-tool"===a?aF(!0):"create-event"===a?aJ(!0):"invite-members"===a?aH(!0):"customize-sidebar"===a&&(a_(!0),bd.markTaskComplete("customizeSidebar"))},inline:!0})}),a9&&(0,f.jsxs)("div",{className:"p-4 border-b border-[#2A2A2A] space-y-3",children:[(0,f.jsx)(l.L,{automations:a7,isLeader:a9,isLoading:a8,onToggle:ba,onDelete:bb}),(0,f.jsx)(k.G,{onOpenFull:()=>aT(!0),templateCount:6})]}),be.shouldShowRitual&&be.ritualData&&(0,f.jsx)(z.E,{ritual:be.ritualData,variant:"compact",showProgress:!0,onViewDetails:()=>a.push("/rituals/founding-class-2026"),className:"mb-4"}),(0,f.jsx)(F.F,{data:bK,isLeader:S,isEditMode:a$,callbacks:{onJoin:()=>t(),onLeave:()=>u(),onToolClick:a=>{let b=aw.find(b=>b.id===a||b.toolId===a);b&&(aP({id:b.id,toolId:b.toolId,placementId:b.placementId,name:b.name,type:b.type}),aR(!0))},onViewAll:()=>a.push(`/spaces/${i}/tools`),onLeaderClick:b=>a.push(`/profile/${b}`),onEventClick:by,onInviteMember:S?()=>aH(!0):void 0,onCreateEvent:S?()=>aJ(!0):void 0,onRemoveTool:S?bB:void 0,onSetupTaskAction:S?a=>{switch(a){case"deploy-tool":aF(!0);break;case"create-event":aJ(!0);break;case"invite-members":aH(!0);break;case"customize-sidebar":a_(!0)}}:void 0}})]})]}),(0,f.jsx)(aa,{activeDrawer:a0,setActiveDrawer:a1,space:{name:e.name,description:e.description,memberCount:e.memberCount,onlineCount:e.onlineCount??0,category:e.category},events:N,tools:aw,leaders:aA,automations:a7.map(a=>({id:a.id,name:a.name,trigger:a.trigger.type,enabled:a.enabled,runCount:a.stats?.timesTriggered})),isLeader:S,onOpenTemplates:()=>aT(!0)}),P&&(0,f.jsx)(ab,{tabs:O,boards:ac,activeBoardId:ad??void 0,addTabModalOpen:aC,setAddTabModalOpen:aD,addWidgetModalOpen:aE,setAddWidgetModalOpen:aF,inviteMemberModalOpen:aG,setInviteMemberModalOpen:aH,createEventModalOpen:aI,setCreateEventModalOpen:aJ,onAddTab:bq,onAddWidget:br,onOpenHiveLab:bs,onQuickDeploy:bA,onInviteMember:bu,onSearchUsers:bv,onCreateEvent:bw,existingMemberIds:aA.map(a=>a.id),existingTools:aK,isLoadingTools:aM,onDeployExistingTool:bt}),aO&&(0,f.jsx)(J.a,{open:aQ,onOpenChange:a=>{aR(a),a||aP(null)},toolId:aO.toolId,spaceId:i??"",placementId:aO.placementId,toolName:aO.name,onExpandToFullPage:()=>{let b=aO.placementId&&i?`space:${i}_${aO.placementId}`:void 0,c=b?`/tools/${aO.toolId}/run?spaceId=${i}&deploymentId=${encodeURIComponent(b)}`:`/tools/${aO.toolId}/run?spaceId=${i}`;a.push(c),aR(!1),aP(null)},runtime:aO.toolId&&a4.tool?{tool:{...a4.tool,status:a4.tool.status||"draft"},state:a4.state,sharedState:a4.sharedState,userState:a4.userState,isLoading:a4.isLoading,isExecuting:a4.isExecuting,isSaving:a4.isSaving,isSynced:a4.isSynced,lastSaved:a4.lastSaved,error:a4.error instanceof Error?a4.error.message:a4.error,executeAction:async(a,b,c)=>{let d=await a4.executeAction(b||"",a,c);return{success:d.success,data:d.state,error:d.error}},updateState:(a,b)=>{a4.updateState({[a]:b})}}:void 0}),(0,f.jsx)(I.s,{open:aj.isOpen,onOpenChange:a=>{a||at()},parentMessage:aj.parentMessage,replies:aj.replies,isLoading:aj.isLoading,isLoadingMore:aj.isLoadingMore,hasMoreReplies:aj.hasMore,currentUserId:c?.uid??"anonymous",onLoadMore:av,onSendReply:async a=>{await au(a)}}),(0,f.jsx)(A.cj,{open:aS,onOpenChange:aT,children:(0,f.jsxs)(A.h,{side:"right",className:"w-full sm:max-w-lg bg-[#0a0a0a] border-l border-white/[0.08]",children:[(0,f.jsx)(A.Fm,{className:"border-b border-white/[0.08] pb-4",children:(0,f.jsx)(A.qp,{className:"text-white",children:"Automation Templates"})}),(0,f.jsx)("div",{className:"py-6 overflow-y-auto max-h-[calc(100vh-8rem)]",children:(0,f.jsx)(k.J,{spaceId:i??"",fetchTemplates:async()=>{let a=await (0,Z.Qn)("/api/automations/templates");if(!a.ok)throw Error("Failed to fetch templates");return a.json()},onApplyTemplate:async(a,b,c)=>{let d=await (0,Z.Qn)(`/api/spaces/${i}/automations/from-template`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateId:a,customValues:b,name:c})});if(!d.ok)throw Error((await d.json()).error||"Failed to apply template");L.oR.success("Automation enabled","It will start working automatically.")},onAutomationCreated:()=>{bc()}})})]})}),(0,f.jsx)(E._,{open:bd.shouldShowOnboarding,onClose:bd.dismiss,data:{spaceName:e.name,spaceId:i??"",memberCount:e.memberCount,templates:y.Ad},onComplete:()=>{bd.markWelcomeSeen()},onDeployTemplate:bA,onOpenHiveLab:bs,onOpenInvite:()=>aH(!0),onSkip:bd.dismiss}),(0,f.jsx)(H.on,{open:bg,onClose:()=>{bh(!1),bf.markAsSeen()},data:{name:e.name,description:e.description,category:e.category,iconUrl:e.iconUrl,bannerUrl:e.bannerUrl,leaders:aA.map(a=>({id:a.id,name:a.name,avatarUrl:a.avatarUrl,role:a.role})),memberCount:e.memberCount,features:(()=>{let a=[];return N.length>0&&a.push({type:"events",title:"Upcoming Events",description:"Join meetups and activities",count:N.length}),aw.length>0&&a.push({type:"tools",title:"Interactive Tools",description:"Polls, signups, and more",count:aw.length}),a.push({type:"discussions",title:"Live Discussions",description:"Chat with the community in real-time"}),a})()},onComplete:()=>{bh(!1),bf.markAsSeen()},onStartChatting:()=>{bh(!1),bf.markAsSeen()},storageKey:i??""}),(0,f.jsx)(p.I,{event:bz,open:aW,onOpenChange:a=>{aX(a),a||aV(null)},onRSVP:bx,onViewBoard:bz?.linkedBoardId?a=>{ap(a),aX(!1),aV(null)}:void 0,currentUserId:c?.uid,spaceId:i??""}),s&&(0,f.jsx)("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96",children:(0,f.jsxs)("div",{className:"rounded-lg border border-red-500/30 bg-red-500/10 p-3 text-sm text-red-400 backdrop-blur-sm",children:[s,(0,f.jsx)("button",{onClick:D,className:"ml-3 underline",children:"Retry"})]})})]})}function ad({spaceId:a}){let[b,c]=g.useState(!1),[d,e]=g.useState(null);g.useEffect(()=>{let b=`hive-space-entered-${a}`,d=sessionStorage.getItem(b),f=window.matchMedia("(prefers-reduced-motion: reduce)").matches;d||f||fetch(`/api/spaces/${a}`).then(a=>a.ok?a.json():null).then(a=>{a?.space&&(e({name:a.space.name,category:a.space.category,onlineCount:a.space.onlineCount}),c(!0))}).catch(()=>{})},[a]);let h=g.useCallback(()=>{sessionStorage.setItem(`hive-space-entered-${a}`,"true"),c(!1)},[a]);return(0,f.jsx)(D.l,{spaceName:d?.name||"",spaceCategory:d?.category,onlineCount:d?.onlineCount,isActive:b&&!!d,onComplete:h,skipAnimation:!b||!d,children:(0,f.jsx)(M.Je,{spaceId:a,children:(0,f.jsx)(ac,{})})})}function ae(){let a=(0,h.useParams)(),b=a?.spaceId;return b?(0,f.jsx)(ad,{spaceId:b}):(0,f.jsx)("div",{className:"min-h-screen bg-[#0A0A0A] flex items-center justify-center",children:(0,f.jsx)("div",{className:"text-[#A1A1A6]",children:"Space not found"})})}},73496:a=>{"use strict";a.exports=require("http2")},74075:a=>{"use strict";a.exports=require("zlib")},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},81630:a=>{"use strict";a.exports=require("http")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},88665:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>J,handler:()=>L,pages:()=>I,routeModule:()=>K,tree:()=>H});var d=c(16978),e=c(48869),f=c(36363),g=c(21884),h=c(37526),i=c(66376),j=c(62599),k=c(78612),l=c(24218),m=c(43040),n=c(13658),o=c(87189),p=c(15653),q=c(50254),r=c(261),s=c(61965),t=c(13106),u=c(26713),v=c(48724),w=c(34261),x=c(8185),y=c(78910),z=c(67506),A=c(50518),B=c(86439),C=c(21674),D=c.n(C),E=c(60786),F=c(60283),G={};for(let a in E)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(G[a]=()=>E[a]);c.d(b,G);let H={children:["",{children:["spaces",{children:["[spaceId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,56501)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/[spaceId]/page.tsx"]}]},{layout:[()=>Promise.resolve().then(c.bind(c,62702)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/[spaceId]/layout.tsx"],error:[()=>Promise.resolve().then(c.bind(c,55888)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/[spaceId]/error.tsx"],loading:[()=>Promise.resolve().then(c.bind(c,79686)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/[spaceId]/loading.tsx"]}]},{layout:[()=>Promise.resolve().then(c.bind(c,69162)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/layout.tsx"],error:[()=>Promise.resolve().then(c.bind(c,43892)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/error.tsx"],loading:[()=>Promise.resolve().then(c.bind(c,23538)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/loading.tsx"]}]},{layout:[()=>Promise.resolve().then(c.bind(c,77e3)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/layout.tsx"],error:[()=>Promise.resolve().then(c.bind(c,38842)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/error.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,21674,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.bind(c,76476)),"/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,48677,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,84344,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,I=["/Users/laneyfraass/Desktop/HIVE/apps/web/src/app/spaces/[spaceId]/page.tsx"],J={require:c,loadChunk:()=>Promise.resolve()},K=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/spaces/[spaceId]/page",pathname:"/spaces/[spaceId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:H},distDir:".next",relativeProjectDir:""});async function L(a,b,d){var C;let G="/spaces/[spaceId]/page";"/index"===G&&(G="/");let M=(0,h.getRequestMeta)(a,"postponed"),N=(0,h.getRequestMeta)(a,"minimalMode"),O=await K.prepare(a,b,{srcPage:G,multiZoneDraftMode:!1});if(!O)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:P,query:Q,params:R,parsedUrl:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=O,af=S.pathname||"/",ag=(0,r.normalizeAppPath)(G),{isOnDemandRevalidate:ah}=O,ai=K.match(af,$),aj=!!$.routes[aa],ak=!!(ai||aj||$.routes[ag]),al=a.headers["user-agent"]||"",am=(0,u.getBotType)(al),an=(0,p.isHtmlBotRequest)(a),ao=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ap=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],aq=(0,s.getIsPossibleServerAction)(a),ar=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",as=!1,at=!1,au=ar?M:void 0,av=ar&&ap&&!ao,aw=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),ax=!al||(0,p.shouldServeStreamingMetadata)(al,ad.htmlLimitedBots);an&&ar&&(ak=!1,ax=!1);let ay=!0===K.isDev||!ak||"string"==typeof M||av,az=an&&ar,aA=null;_||!ak||ay||aq||au||av||(aA=aa);let aB=aA;!aB&&K.isDev&&(aB=aa),K.isDev||_||!ak||!ap||av||(0,k.d)(a.headers);let aC={...E,tree:H,pages:I,GlobalError:D(),handler:L,routeModule:K,__next_app__:J};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:G,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=K.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return K.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aE.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aD} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${a.url}`)})},m=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:Q,params:R,page:ag,sharedContext:{buildId:P},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:R,routeModule:K,page:G,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:ax,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,dir:c(33873).join(process.cwd(),K.relativeProjectDir),isDraftMode:_,isRevalidate:ak&&!f&&!av,botType:am,isOnDemandRevalidate:ah,isPossibleServerAction:aq,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,devtoolSegmentExplorer:ad.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:as}:{},experimental:{isRoutePPREnabled:ar,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[]},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>K.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:K.isDev}},l=await k(e,i),{metadata:m}=l,{cacheControl:n,headers:o={},fetchTags:p}=m;if(p&&(o[y.NEXT_CACHE_TAGS_HEADER]=p),a.fetchMetrics=m.fetchMetrics,ak&&(null==n?void 0:n.revalidate)===0&&!K.isDev&&!ar){let a=m.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:l,headers:o,rscData:m.flightData,postponed:m.postponed,status:m.statusCode,segmentData:m.segmentData},cacheControl:n}},o=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i})=>{let j,k=!1===K.isDev,l=c||b.writableEnded;if(ah&&ab&&!f&&!N)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(j=(0,w.parseFallbackField)(ai.fallback)),j===w.FallbackMode.PRERENDER&&(0,u.isBot)(al)&&(!ar||an)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(j!==w.FallbackMode.NOT_FOUND||f)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),!N&&j!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!l&&!_&&T&&(k||!aj)){let b;if((k||ai)&&j===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ar&&!ap){let c="string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:k?ag:null;if(b=await K.handleResponse({cacheKey:c,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ar,responseGenerator:async()=>m({span:i,postponed:void 0,fallbackRouteParams:k||at?(0,n.u)(ag):null}),waitUntil:d.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=ah||g||!au?void 0:au;if(as&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let p=T&&ar&&((0,h.getRequestMeta)(a,"renderFallbackShell")||at)?(0,n.u)(af):null;return m({span:i,postponed:o,fallbackRouteParams:p})},p=async c=>{var f,g,i,j,k;let l,n=await K.handleResponse({cacheKey:aA,responseGenerator:a=>o({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:ar,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),K.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!n){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=n.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=n.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof n.value.postponed;ak&&!av&&(!p||ao)&&(N||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":n.isMiss?"MISS":n.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=n;if(au)l={revalidate:0,expire:void 0};else if(N&&ap&&!ao&&ar)l={revalidate:0,expire:void 0};else if(!K.isDev)if(_)l={revalidate:0,expire:void 0};else if(ak){if(n.cacheControl)if("number"==typeof n.cacheControl.revalidate){if(n.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${n.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:n.cacheControl.revalidate,expire:(null==(j=n.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(n.cacheControl=l,"string"==typeof aw&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];N&&ak&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(aw);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:n.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...n,value:{...n.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&au)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(N&&ak||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(N&&ak&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ap&&ar||(b.statusCode=q.status),!N&&q.status&&F.RedirectStatusCode[q.status]&&ap&&(b.statusCode=200),p&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ap&&!_){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:av?{revalidate:0,expire:void 0}:n.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl})}let u=q.html;if(!p||N||ap)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:n.cacheControl});if(as)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),m({span:c,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},p));await p(aF)}catch(b){throw b instanceof B.NoFallbackError||await K.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ak,isOnDemandRevalidate:ah})},ac),b}}},91645:a=>{"use strict";a.exports=require("net")},93006:(a,b,c)=>{"use strict";c.d(b,{Je:()=>v,Fv:()=>l,rY:()=>u,nW:()=>i,gC:()=>p});var d=c(44748),e=c(35893),f=c(51716);let g=(0,e.createContext)(null);function h({spaceId:a,children:b}){let[c,h]=(0,e.useState)(null),[i,j]=(0,e.useState)({isMember:!1,isLeader:!1}),[k,l]=(0,e.useState)(!0),[m,n]=(0,e.useState)(null),[o,p]=(0,e.useState)(!1),q=(0,e.useCallback)(async()=>{if(a){l(!0),n(null);try{let b=await (0,f.Qn)(`/api/spaces/${a}`);if(!b.ok)throw Error(`${b.status}`);let c=await b.json(),d=c.data||c,e={id:d.id||a,name:d.name,description:d.description||"",category:d.category||"club",slug:d.slug,iconUrl:d.iconUrl||d.icon,bannerUrl:d.bannerUrl||d.banner,memberCount:d.memberCount||0,onlineCount:d.onlineCount,isVerified:d.isVerified||!1,isActive:!1!==d.isActive,visibility:d.visibility||"public",settings:d.settings,creator:d.creator,createdAt:d.createdAt};h(e);let g=d.membership||{},i=(g.role||d.membershipRole||"").toLowerCase(),k=(g.status||d.membershipStatus||"").toLowerCase(),l=["owner","admin","moderator","member"].includes(i)?i:void 0,m=["active","pending","invited","banned"].includes(k)?k:void 0,n=!!(d.isMember||g.isActive||["active","joined"].includes(k)),o=!!(["owner","leader","admin","moderator"].includes(i)||g.isLeader);j({isMember:n,isLeader:o,role:l,status:m,joinedAt:g.joinedAt})}catch(a){n(a instanceof Error?a.message:"Failed to load space")}finally{l(!1)}}},[a]),r=(0,e.useCallback)(async()=>{if(!c||o)return!1;p(!0);let b=c.memberCount;j(a=>({...a,isMember:!0,role:"member"})),h(a=>a?{...a,memberCount:b+1}:a);try{if((await (0,f.Qn)("/api/spaces/join-v2",{method:"POST",body:JSON.stringify({spaceId:a})})).ok)return await q(),!0;return j(a=>({...a,isMember:!1,role:void 0})),h(a=>a?{...a,memberCount:b}:a),!1}catch{return j(a=>({...a,isMember:!1,role:void 0})),h(a=>a?{...a,memberCount:b}:a),!1}finally{p(!1)}},[c,a,q,o]),s=(0,e.useCallback)(async()=>{if(!c||o)return!1;if("owner"===i.role)return n("Owners must transfer ownership before leaving"),!1;p(!0);let b=c.memberCount,d={...i};j({isMember:!1,isLeader:!1}),h(a=>a?{...a,memberCount:Math.max(0,b-1)}:a);try{if((await (0,f.Qn)("/api/spaces/leave",{method:"POST",body:JSON.stringify({spaceId:a})})).ok)return!0;return j(d),h(a=>a?{...a,memberCount:b}:a),!1}catch{return j(d),h(a=>a?{...a,memberCount:b}:a),!1}finally{p(!1)}},[c,a,i,o]),t=(0,e.useCallback)(async()=>{await q()},[q]),u=(0,e.useMemo)(()=>({space:c,spaceId:a,membership:i,isLoading:k,error:m,joinSpace:r,leaveSpace:s,refresh:t}),[c,a,i,k,m,r,s,t]);return(0,d.jsx)(g.Provider,{value:u,children:b})}function i(){let a=(0,e.useContext)(g);if(!a)throw Error("useSpaceMetadata must be used within SpaceContextProvider");return a}let j=(0,e.createContext)(null);function k({children:a}){let{spaceId:b}=i(),[c,g]=(0,e.useState)([]),[h,k]=(0,e.useState)(!1),l=(0,e.useCallback)(async()=>{if(b){k(!0);try{let a=await (0,f.Qn)(`/api/spaces/${b}/events?limit=10&upcoming=true`);if(!a.ok)return void g([]);let c=await a.json(),d=((c.data||c).events||[]).map(a=>({id:a.id,title:a.title,description:a.description,type:a.type,startDate:a.startDate instanceof Date?a.startDate.toISOString():String(a.startDate),endDate:a.endDate instanceof Date?a.endDate.toISOString():String(a.endDate),location:a.location,virtualLink:a.virtualLink,currentAttendees:a.currentAttendees||0,maxAttendees:a.maxAttendees,userRSVP:a.userRSVP||null,organizer:a.organizer}));g(d)}catch{g([])}finally{k(!1)}}},[b]),m=(0,e.useMemo)(()=>({events:c,isEventsLoading:h,refreshEvents:l}),[c,h,l]);return(0,d.jsx)(j.Provider,{value:m,children:a})}function l(){let a=(0,e.useContext)(j);if(!a)throw Error("useSpaceEvents must be used within SpaceContextProvider");return a}function m(a){let[b,c]=(0,e.useState)(null),[d,g]=(0,e.useState)(!0),[h,i]=(0,e.useState)(null),[j,k]=(0,e.useState)(!1),l=(0,e.useMemo)(()=>b?.tabs??[],[b]),m=(0,e.useMemo)(()=>b?.widgets??[],[b]),n=(0,e.useMemo)(()=>b?.permissions??null,[b]),o=(0,e.useMemo)(()=>n?.canEditStructure??!1,[n]),p=(0,e.useCallback)(async()=>{if(a){g(!0),i(null);try{let b=await (0,f.Qn)(`/api/spaces/${a}/structure`);if(!b.ok){let a=await b.text().catch(()=>"");throw Error(`${b.status}: ${a}`)}let d=await b.json(),e=d.data||d;c(e)}catch(a){i(a instanceof Error?a.message:"Failed to load structure")}finally{g(!1)}}},[a]),q=(0,e.useCallback)(async b=>{if(!a||!o)return null;k(!0),i(null);try{let d=await (0,f.Qn)(`/api/spaces/${a}/structure`,{method:"PATCH",body:JSON.stringify({operations:b})}),e=await d.json();if(!d.ok||!e.success)throw Error(e.error||"Batch operation failed");return e.data&&c(e.data),e.operations}catch(a){return i(a instanceof Error?a.message:"Failed to update structure"),null}finally{k(!1)}},[a,o]),r=(0,e.useCallback)(async a=>{if(!b)return null;let d=`temp-tab-${Date.now()}`,e={id:d,name:a.name,type:a.type,order:a.order??b.tabs.length,isDefault:!1,isVisible:a.isVisible??!0,widgetIds:[]};c(a=>a?{...a,tabs:[...a.tabs,e]}:a);let f=await q([{op:"addTab",data:a}]);return f&&f.results[0]?.success?f.results[0].entityId??null:(c(a=>a?{...a,tabs:a.tabs.filter(a=>a.id!==d)}:a),null)},[b,q]),s=(0,e.useCallback)(async(a,d)=>{if(!b)return!1;let e=[...b.tabs];c(b=>b?{...b,tabs:b.tabs.map(b=>b.id===a?{...b,...d}:b)}:b);let f=await q([{op:"updateTab",tabId:a,data:d}]);return!!f&&!!f.results[0]?.success||(c(a=>a?{...a,tabs:e}:a),!1)},[b,q]),t=(0,e.useCallback)(async a=>{if(!b)return!1;let d=b.tabs.find(b=>b.id===a);if(d?.isDefault)return i("Cannot remove the default tab"),!1;let e=[...b.tabs];c(b=>b?{...b,tabs:b.tabs.filter(b=>b.id!==a)}:b);let f=await q([{op:"removeTab",tabId:a}]);return!!f&&!!f.results[0]?.success||(c(a=>a?{...a,tabs:e}:a),!1)},[b,q]),u=(0,e.useCallback)(async a=>{if(!b)return!1;let d=[...b.tabs];c(b=>{if(!b)return b;let c=a.map((a,c)=>{let d=b.tabs.find(b=>b.id===a);return d?{...d,order:c}:null}).filter(Boolean);return{...b,tabs:c}});let e=await q([{op:"reorderTabs",order:a}]);return!!e&&!!e.results[0]?.success||(c(a=>a?{...a,tabs:d}:a),!1)},[b,q]),v=(0,e.useCallback)(async a=>{if(!b)return null;let d=`temp-widget-${Date.now()}`,e={id:d,type:a.type,title:a.title,config:a.config??{},order:b.widgets.length,isEnabled:!0,isVisible:!0};c(a=>a?{...a,widgets:[...a.widgets,e]}:a);let f=await q([{op:"addWidget",data:a}]);return f&&f.results[0]?.success?f.results[0].entityId??null:(c(a=>a?{...a,widgets:a.widgets.filter(a=>a.id!==d)}:a),null)},[b,q]),w=(0,e.useCallback)(async(a,d)=>{if(!b)return!1;let e=[...b.widgets];c(b=>b?{...b,widgets:b.widgets.map(b=>b.id===a?{...b,...d}:b)}:b);let f=await q([{op:"updateWidget",widgetId:a,data:d}]);return!!f&&!!f.results[0]?.success||(c(a=>a?{...a,widgets:e}:a),!1)},[b,q]),x=(0,e.useCallback)(async a=>{if(!b)return!1;let d=[...b.widgets];c(b=>b?{...b,widgets:b.widgets.filter(b=>b.id!==a)}:b);let e=await q([{op:"removeWidget",widgetId:a}]);return!!e&&!!e.results[0]?.success||(c(a=>a?{...a,widgets:d}:a),!1)},[b,q]),y=(0,e.useCallback)(async(a,d)=>{if(!b)return!1;let e=[...b.tabs];c(b=>b?{...b,tabs:b.tabs.map(b=>b.id!==d||b.widgetIds.includes(a)?b:{...b,widgetIds:[...b.widgetIds,a]})}:b);let f=await q([{op:"attachWidget",widgetId:a,tabId:d}]);return!!f&&!!f.results[0]?.success||(c(a=>a?{...a,tabs:e}:a),!1)},[b,q]),z=(0,e.useCallback)(async(a,d)=>{if(!b)return!1;let e=[...b.tabs];c(b=>b?{...b,tabs:b.tabs.map(b=>b.id===d?{...b,widgetIds:b.widgetIds.filter(b=>b!==a)}:b)}:b);let f=await q([{op:"detachWidget",widgetId:a,tabId:d}]);return!!f&&!!f.results[0]?.success||(c(a=>a?{...a,tabs:e}:a),!1)},[b,q]),A=(0,e.useCallback)(a=>{if(!b)return[];let c=b.tabs.find(b=>b.id===a);return c?c.widgetIds.map(a=>b.widgets.find(b=>b.id===a)).filter(Boolean):[]},[b]),B=(0,e.useMemo)(()=>l.find(a=>a.isDefault)??l[0]??null,[l]),C=(0,e.useMemo)(()=>l.filter(a=>a.isVisible).sort((a,b)=>a.order-b.order),[l]),D=(0,e.useMemo)(()=>m.filter(a=>a.isEnabled&&a.isVisible).sort((a,b)=>a.order-b.order),[m]);return{structure:b,tabs:l,widgets:m,permissions:n,isLoading:d,isMutating:j,error:h,defaultTab:B,visibleTabs:C,enabledWidgets:D,canEdit:o,addTab:r,updateTab:s,removeTab:t,reorderTabs:u,addWidget:v,updateWidget:w,removeWidget:x,attachWidgetToTab:y,detachWidgetFromTab:z,getWidgetsForTab:A,reload:p,executeBatch:q}}let n=(0,e.createContext)(null);function o({children:a}){let{spaceId:b}=i(),{tabs:c,widgets:f,permissions:g,visibleTabs:h,enabledWidgets:j,defaultTab:k,isLoading:l,isMutating:o,error:p,canEdit:q,getWidgetsForTab:r,reload:s}=m(b),t=(0,e.useMemo)(()=>({tabs:c,widgets:f,permissions:g,visibleTabs:h,enabledWidgets:j,defaultTab:k,isStructureLoading:l,isMutating:o,structureError:p,canEdit:q,getWidgetsForTab:r,reloadStructure:s}),[c,f,g,h,j,k,l,o,p,q,r,s]);return(0,d.jsx)(n.Provider,{value:t,children:a})}function p(){let a=(0,e.useContext)(n);if(!a)throw Error("useSpaceStructureContext must be used within SpaceContextProvider");return a}let q=(0,e.createContext)(null);function r({children:a,initialTab:b}){let{tabs:c,defaultTab:f,getWidgetsForTab:g}=p(),[h,i]=(0,e.useState)(b??null),j=(0,e.useMemo)(()=>h?c.find(a=>a.id===h)??f:f,[h,c,f]),k=(0,e.useMemo)(()=>j?g(j.id):[],[j,g]),l=(0,e.useMemo)(()=>({activeTabId:h,setActiveTabId:i,activeTab:j,activeTabWidgets:k}),[h,j,k]);return(0,d.jsx)(q.Provider,{value:l,children:a})}let s=(0,e.createContext)(null);function t({children:a}){let{spaceId:b,membership:c,refresh:g}=i(),{canEdit:h}=p(),{addTab:j,updateTab:k,removeTab:l,reorderTabs:n,addWidget:o,updateWidget:q,removeWidget:r,attachWidgetToTab:t,detachWidgetFromTab:u}=m(b),v=(0,e.useCallback)(async a=>{if(!c.isLeader)return!1;try{if((await (0,f.Qn)(`/api/spaces/${b}`,{method:"PATCH",body:JSON.stringify({settings:a})})).ok)return await g(),!0;return!1}catch{return!1}},[c.isLeader,b,g]),w=(0,e.useMemo)(()=>c.isLeader&&h?{addTab:j,updateTab:k,removeTab:l,reorderTabs:n,addWidget:o,updateWidget:q,removeWidget:r,attachWidgetToTab:t,detachWidgetFromTab:u,updateSpaceSettings:v}:null,[c.isLeader,h,j,k,l,n,o,q,r,t,u,v]),x=(0,e.useMemo)(()=>({leaderActions:w,isLeader:c.isLeader,canEdit:h}),[w,c.isLeader,h]);return(0,d.jsx)(s.Provider,{value:x,children:a})}function u(){let a=(0,e.useContext)(s);if(!a)throw Error("useSpaceLeader must be used within SpaceContextProvider");return a}function v({spaceId:a,children:b,initialTab:c}){return(0,d.jsx)(h,{spaceId:a,children:(0,d.jsx)(k,{children:(0,d.jsx)(o,{children:(0,d.jsx)(r,{initialTab:c,children:(0,d.jsx)(t,{children:b})})})})})}},94735:a=>{"use strict";a.exports=require("events")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[7545,1684,6402,113,3698,3449,6920,6912,519,4664,4643,9634,1265,2098,1493,6621,1686,282,9750,2867,1482,9131,6602,4425,2748,2273,6330,8060,4775,1944],()=>b(b.s=88665));module.exports=c})();